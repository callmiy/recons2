!function(e){function t(r){if(o[r])return o[r].exports;var n=o[r]={exports:{},id:r,loaded:!1};return e[r].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var o={};return t.m=e,t.c=o,t.p="",t(0)}([function(e,t,o){"use strict";function r(e,t){t.otherwise("/"),e.state("home",{url:"/",kanmiiTitle:"Home",template:o(28)})}o(1),o(25);var n=o(7),i=angular.module("lc-root-app",["rootApp","ui.router","form-m","lc"]);i.config(n.interpolateProviderConfig),i.run(["$rootScope","$state","$stateParams",function(e,t,o){e.$state=t,e.$stateParams=o}]),i.config(r),r.$inject=["$stateProvider","$urlRouterProvider"]},function(e,t,o){"use strict";function r(e){e.state("form_m",{url:"/form-m",kanmiiTitle:"Form M",template:o(24),controller:"FormMController as formMHome"})}function n(e,t){var o={title:"List Form M",viewName:"listFormM",select:function(){t.updateAddFormMTitle(),e.go("form_m.list")}},r="Form M",n=!0,i={title:r,active:!0,viewName:"addFormM",select:function(){n&&e.go("form_m.add"),n=!0}},a={title:"Reports",active:!1,viewName:"formMReports",select:function(){t.updateAddFormMTitle(),e.go("form_m.add")}},c={title:"Bids",active:!1,viewName:"bids",select:function(){t.updateAddFormMTitle(),e.go("form_m.bids")}};t.tabs={listFormM:o,addFormM:i,bids:c,reports:a},t.updateAddFormMTitle=function(e){t.tabs.addFormM.title=e?'Details of "'+e.number+'"':r},t.goToFormM=function(o){n=!1,e.transitionTo("form_m.add",{formM:o}),t.tabs.addFormM.active=!0}}o(2),o(11),o(16),o(18),o(19),o(21);var i=angular.module("form-m",["rootApp","ui.router","list-form-m","upload-form-m","add-form-m","form-m-bids"]);i.config(r),r.$inject=["$stateProvider"],i.controller("FormMController",n),n.$inject=["$state","$scope"]},function(e,t,o){"use strict";function r(e){e.state("form_m.add",{kanmiiTitle:"Add form M",params:{showSummary:null,formM:null},views:{addFormM:{templateUrl:o(5).buildUrl("form-m/add-form-m/add-form-m.html"),controller:"AddFormMStateController as addFormMState"}}})}function n(e,t,o,r,n,i,a,c,s,l,d,m,u){function f(e,t){i.formM=null,b.formM=e,b.formM.lcRef={lc_number:null},b.detailedFormM=t,t&&(b.fieldIsEditable={number:!1,currency:!1,applicant:!1,date_received:!1,amount:!1,lcRef:!1}),s.updateAddFormMTitle(t),h()}function p(e,t){if(e){var o=["applicant","currency"].concat(s.newFormMForm.lcRef?["lcRef"]:[]);a(e,[{form:s.newFormMForm,elements:o}]),e.$setPristine(),e.$setUntouched()}b.detailedFormM=null,b.fieldIsEditable={number:!0,currency:!0,applicant:!0,date_received:!0,amount:!0,lcRef:!0},d.init(t||i.formM,f),b.searchFormM={}}function h(){var e=i.showSummary;i.showSummary=null,e&&l.showDialog({title:'"'+b.formM.number+'" successfully saved',text:e,infoOnly:!0})}var b=this;p(),b.reset=p,b.enableFieldEdit=function(e){b.fieldIsEditable[e]=b.detailedFormM?!b.fieldIsEditable[e]:!0},b.disableSubmitBtn=function(){if(s.newFormMForm.$invalid)return!0;if(r.has(b.formM.coverForm,"$invalid")&&b.formM.coverForm.$invalid)return!0;if(r.has(b.formM.bidForm,"$invalid")&&b.formM.bidForm.$invalid)return!0;if(r.has(b.formM.issuesForm,"$invalid")&&b.formM.issuesForm.$invalid)return!0;if(r.has(b.formM.commentForm,"$invalid")&&b.formM.commentForm.$invalid)return!0;if(d.showEditBid||d.showCommentForm)return!0;var e=d.compareFormMs(b.detailedFormM);return e&&r.all(e)?d.bid.goods_description&&d.bid.amount?!1:r.isEmpty(b.formM.cover)?b.formM.lcRef.lc_number?!1:!b.formM.selectedIssues.length:!1:!1},b.getLc=function(e){return u({lc_number:e.trim(),mf:b.formM.number})},b.getApplicant=e,b.getCurrency=t,b.datePickerFormat="dd-MMM-yyyy",b.datePickerIsOpen=!1,b.openDatePicker=function(){b.datePickerIsOpen=!0},b.getUploadedFormM=function(){b.detailedFormM=null,p(),o.searchWithModal().then(function(e){if(e.number)p(null,e.number);else{var o=e.uploaded;b.searchFormM=o,b.formM.number=o.mf,b.formM.amount=o.cost_freight,b.formM.goods_description=o.goods_description,t(o.ccy).then(function(e){b.formM.currency=e[0]})}})},b.submit=function(e){d.saveFormM(e,b.detailedFormM).then(function(e){c.go("form_m.add",e)},function(e){n(e,m)})}}o(3),o(4),o(8),o(9),o(10);var i=angular.module("add-form-m",["ui.router","rootApp","customer","search-detailed-or-uploaded-form-m","form-m-service","lc-cover","lc-issue","lc-bid","form-m-comment","lc-bid-request","confirmation-dialog","add-form-m-form-m-object","lc-service","complex-object-validator"]);i.config(r),r.$inject=["$stateProvider"],i.controller("AddFormMStateController",n),n.$inject=["getTypeAheadCustomer","getTypeAheadCurrency","SearchDetailedOrUploadedFormMService","underscore","xhrErrorDisplay","$stateParams","resetForm2","$state","$scope","confirmationDialog","formMObject","formMAttributesVerboseNames","getTypeAheadLetterOfCredit"]},function(e,t){"use strict";function o(e,t,o,r,n,i,a,c,s,l,d,m){function u(){function u(e){m.query({ct:h.ct_id,pk:e,not_deleted:!0}).$promise.then(function(e){h.comments=e},function(e){console.log("xhr = ",e)})}function f(){t.query({form_m_number:h.number}).$promise.then(function(e){e.forEach(function(e){e.closed_at?h.closedIssues.push(e):h.nonClosedIssues.push(e)})})}function p(){o.query({form_m_number:h.number}).$promise.then(function(e){h.covers=e},function(e){console.log(e)})}var h=this;h.datePickerFormat="dd-MMM-yyyy";var b=40;h.setBids=function(){h.existingBids=[],e.getPaginated({mf:h.number}).$promise.then(function(e){if(e.count){var t=e.results;t.length&&t.forEach(function(e){var t=0,o=0;a.each(e.allocations,function(e){t+=e.amount_allocated,o+=e.amount_utilized}),e.total_allocation=t,e.total_utilization=o,e.unallocated=e.amount-t,h.existingBids.push(e)})}},function(e){console.log("xhr = ",e)})},h.init=function(e,t){function o(){h.bid={},h.showEditBid=!1,h.showBidForm=!1,h.existingBids=[],h.closedIssues=[],h.commentText=null,h.showEditComment=!1,h.showCommentForm=!1,h.comments=[],h.nonClosedIssues=[],h.selectedIssues=[],h.issue=null,h.showIssueForm=!1,h.covers=[],h.cover={},h.showCoverForm=!1,h.date_received=new Date,h.number=null,h.applicant=null,h.currency=null,h.amount=null,h.goods_description=null,h.form_m_issues=null,h.url=null,h.ct_id=null,h._id=null,h.lc_number=null}o();var r;e?l.getPaginated({number:e}).$promise.then(function(e){e.count&&(r=e.results[0],h.date_received=new Date(r.date_received),h.number=r.number,h.applicant=r.applicant_data,h.currency=r.currency_data,h.amount=Number(r.amount),h.goods_description=r.goods_description,h.form_m_issues=r.form_m_issues,h.url=r.url,h.ct_id=r.ct_id,h.ct_url=r.ct_url,h._id=r.id,h.lc_number=r.lc,h.setBids(),f(),p(),u(h._id)),t(h,r)}):t(h)},h.formatIssueText=function(e){return e.replace(/:ISSUE$/i,"")},h.closeIssue=function(e,o){function a(){var t="Issue closed successfully:\n"+h.formatIssueText(e.issue_text);r.showDialog({title:"Close issue",text:t,infoOnly:!0}),h.nonClosedIssues.splice(o,1),h.closedIssues.push(e)}function c(e){i(e)}var s='Sure you want to close issue:\n"'+h.formatIssueText(e.issue_text)+'"?';r.showDialog({title:"Close issue",text:s}).then(function(o){o&&(e.closed_at=n(new Date),t.put(e).$promise.then(a,c))})},h.createIssuesMessage=function(e){if(e=h.nonClosedIssues.concat(e&&e.length?e:[]),!e.length)return"";var t="\n\n\nPlease note the following issues which must be regularized before the LC request can be treated:\n";return a.each(e,function(e,o){++o,t+="("+o+") "+h.formatIssueText(e.issue_text)+"\n"}),t},h.createFormMMessage=function(){var e=c("number")(h.amount,2),t=h.lc_number?h.lc_number+"/":"",o=h.applicant.name+" - "+t+h.number+" - "+h.currency.code+" "+e;return o+"\n\nForm M Number : "+h.number+"\nValue         : "+h.currency.code+" "+e+"\nApplicant     : "+h.applicant.name},h.showSummary=function(){r.showDialog({title:h.number,text:h.createFormMMessage()+h.createIssuesMessage(),infoOnly:!0})},h.getFreshIssues=function(e){var t=[];h.selectedIssues.forEach(function(e){t.push(e.id)});var o=[],r=new RegExp(".+/(\\d+)$");return o.concat(h.nonClosedIssues).concat(h.closedIssues).forEach(function(e){t.push(r.exec(e.issue)[1])}),s({text:e,exclude_issue_ids:t.join(",")})},h.saveFormM=function(e,t){function o(t){var o=h.createFormMMessage()+h.createIssuesMessage(t.new_issues);i.bid&&(o+="\n\nBid Amount     : "+e.currency.code+" "+c("number")(i.bid.amount,2)),delete t.new_issues,s.resolve({showSummary:o,formM:t.number})}function r(e){s.reject(e)}var i={applicant:e.applicant.url,currency:e.currency.url,date_received:n(e.date_received),amount:e.amount,number:e.number,goods_description:e.goods_description};e.lcRef.lc_number&&(i.lc=e.lcRef.lc_number),e.bid.amount&&e.bid.goods_description&&(i.goods_description=h.goods_description=e.bid.goods_description,i.bid={amount:Number(e.bid.amount),maturity:n(e.bid.maturity)}),e.selectedIssues.length&&(i.issues=e.selectedIssues),a.isEmpty(e.cover)||(i.cover={amount:e.cover.amount,cover_type:e.cover.cover_type[0]});var s=d.defer();return t?(a.all(h.compareFormMs(t,e))&&(e.lcRef.lc_number||(i.do_not_update="do_not_update"),i.url=e.url),i.id=t.id,new l(i).$put(o,r)):new l(i).$save(o,r),s.promise},h.editFormM=function(e){return e.id=h._id,l.put(e).$promise},h.compareFormMs=function(e,t){if(!e)return{all:!1};var o=t?t:h;return{number:o.number&&o.number===e.number,date_received:angular.equals(o.date_received,new Date(e.date_received)),amount:h.amount&&o.amount===Number(e.amount),currency:o.currency&&o.currency.code===e.currency_data.code,applicant:o.applicant&&o.applicant.name===e.applicant_data.name,goods_description:o.goods_description===e.goods_description}},h.addComment=function(e){var t=d.defer();return m.save({content_type:h.ct_url,object_id:h._id,text:e}).$promise.then(function(e){var o=e.text;r.showDialog({title:'Comment successfully created "'+o.slice(0,b)+'"',text:o,infoOnly:!0}),h.comments.push(e),t.resolve(e)},function(e){i(e)}),t.promise},h.closeComment=function(e){var t=d.defer(),o=e.text;return r.showDialog({title:'Close comment "'+o.slice(0,b)+'"',text:"Sure you want to close comment:\n===============================\n"+o}).then(function(n){n&&(e.deleted_at=(new Date).toJSON(),m.put(e).$promise.then(function(e){r.showDialog({title:'Comment successfully closed "'+o.slice(0,b)+'"',text:o,infoOnly:!0}),t.resolve(e);var n=[];h.comments.forEach(function(t){t.id!==e.id&&n.push(t)}),h.comments=n},function(e){i(e)}))}),t.promise},h.editComment=function(e,t){var o=d.defer();return r.showDialog({title:'Edit comment "'+t.text.slice(0,b)+'"',text:"Are you sure you want to edit comment:\n======================================\n"+t.text}).then(function(n){n&&(t.text=e,m.put(t).$promise.then(function(t){r.showDialog({title:'Comment successfully changed "'+e.slice(0,b)+'"',text:e,infoOnly:!0}),o.resolve(t);for(var n=angular.copy(h.comments),i=0,a=n.length;a>i;i++)if(t.id===n[i].id){n[i]=t;break}h.comments=n},function(e){i(e)}))}),o.promise}}return new u}var r=angular.module("add-form-m-form-m-object",["rootApp","lc-issue-service","lc-cover-service","form-m-service","comment-service"]);r.factory("formMObject",o),o.$inject=["LcBidRequest","LCIssueConcrete","FormMCover","confirmationDialog","formatDate","xhrErrorDisplay","underscore","$filter","getTypeAheadLCIssue","FormM","$q","Comment"]},function(e,t,o){"use strict";function r(){return{restrict:"A",templateUrl:o(5).buildUrl("form-m/add-form-m/lc-issue/lc-issue.html"),scope:!0,bindToController:{onIssuesChanged:"&"},controller:"LcIssueDirectiveController as lcIssue"}}function n(e,t,o,r){function n(e){i.title=a,r.selectedIssues=[],r.issue=null,e&&t(e,[{form:e,elements:["issue"]}])}var i=this;i.formM=r;var a="Add Letter Of Credit Issues";n(),i.issueSelected=function(t,n){r.selectedIssues.push(n),r.issue=null,o(e.issuesForm,"issue")},i.deleteIssue=function(e){i.formM.selectedIssues.splice(e,1)},i.toggleShow=function(e){r.showIssueForm=i.formM.amount&&i.formM.number&&!r.showIssueForm,r.showIssueForm?i.title="Dismiss":n(e)},e.$watch(function(){return i.formM},function(t){i.formM.issuesForm=e.issuesForm,t&&(t.amount&&t.number||n(r.issueForm))},!0),e.$watch(function(){return r.showIssueForm},function(){e.issuesForm.issue.$validate()})}var i=angular.module("lc-issue",["rootApp","add-form-m-form-m-object"]);i.directive("lcIssue",r),r.$inject=[],i.controller("LcIssueDirectiveController",n),n.$inject=["$scope","resetForm2","clearFormField","formMObject"],i.directive("validateIssues",function(){return{restrict:"A",require:"ngModel",link:function(e,t,o,r){var n=e.lcIssue;r.$validators.issues=function(){return!n.formM.showIssueForm||Boolean(n.formM.selectedIssues.length)}}}})},function(e,t,o){"use strict";function r(e){return n.buildUrl("app")+"/"+e}var n=o(6);e.exports={buildUrl:r}},function(e,t,o){"use strict";function r(e){return n.buildUrl(i,e)}var n=o(7),i="letter_of_credit";e.exports={buildUrl:r,appName:i}},function(e,t){"use strict";function o(e,t){return staticPrefix+e+"/js/"+t}function r(e){e.run(["$rootScope",function(e){e.staticPrefix=staticPrefix,e.addIconSrc=staticPrefix+"core_recons/css/images/icon_addposting.gif"}])}var n=["$interpolateProvider",function(e){e.startSymbol("{$"),e.endSymbol("$}")}];e.exports={interpolateProviderConfig:n,buildUrl:o,rootAppName:"core_recons",setStaticPrefix:r}},function(e,t,o){"use strict";function r(){return{restrict:"A",templateUrl:o(5).buildUrl("form-m/add-form-m/lc-cover/lc-cover.html"),scope:!0,bindToController:{formM:"=mfContext",cover:"=",onCoverChanged:"&"},controller:"LcCoverDirectiveController as lcCover"}}function n(e,t,o,r,n){function i(e){a.title=c,a.coverTypes=null,n.cover={},e&&(e.$setPristine(),e.$setUntouched())}var a=this;a.formM=n;var c="Register Cover";i(),a.isValid=function(t,o){return r(e,"coverForm",t,o)},a.amountGetterSetter=function(e){return arguments.length?void(/[\d,\.]+/.test(e)?n.cover.amount=Number(e.replace(/,/g,"")):n.cover.amount=null):n.cover.amount?o("number")(n.cover.amount,2):""},a.toggleShow=function(e){n.showCoverForm=a.formM.amount&&a.formM.number&&!n.showCoverForm,n.showCoverForm?(a.title="Dismiss",a.coverTypes=t,n.cover.amount=a.formM.amount):i(e)},e.$watch(function(){return a.formM},function(t){n.coverForm=e.coverForm,t&&(t.amount&&t.number||i(n.coverForm))},!0)}var i=angular.module("lc-cover",["rootApp","add-form-m-form-m-object"]);i.directive("lcCover",r),r.$inject=[],i.controller("LcCoverDirectiveController",n),n.$inject=["$scope","formMCoverTypes","$filter","formFieldIsValid","formMObject"]},function(e,t,o){"use strict";function r(){return{restrict:"A",templateUrl:o(5).buildUrl("form-m/add-form-m/lc-bid/lc-bid.html"),scope:!0,controller:"LcBidDirectiveController as lcBid"}}function n(e,t,o,r,n,i,a,c,s,l,d,m){function u(e){if(g.datePickerIsOpen={bidRequestedDate:!1,bidCreatedDate:!1,bidMaturityDate:!1},g.title=v,g.formM.showBidForm=!1,g.formM.showEditBid=!1,g.bidToEdit=null,c.bid={},g.showAllocateFx=!1,e){var t=["bidMaturityDate","bidAmount","bidGoodsDescription"];s(e,[{form:e,elements:t}])}}function f(){g.bidToEdit.amount=Number(g.bidToEdit.amount),g.formM.bid.amount=g.bidToEdit.amount,g.formM.bid.downloaded=g.bidToEdit.downloaded,g.bidToEdit.created_at=new Date(g.bidToEdit.created_at),g.formM.bid.created_at=g.bidToEdit.created_at,g.bidToEdit.requested_at=g.bidToEdit.requested_at?new Date(g.bidToEdit.requested_at):null,g.formM.bid.requested_at=g.bidToEdit.requested_at,g.bidToEdit.maturity=g.bidToEdit.maturity?new Date(g.bidToEdit.maturity):null,g.formM.bid.maturity=g.bidToEdit.maturity}function p(e){return e?l(e).format("DD-MMM-YYYY"):null}function h(e){var o="\n\nForm M:           "+g.bidToEdit.form_m_number,r=c.currency.code;return e.amount||(o+="\nBid Amount\n  before edit:    "+r+t("number")(g.bidToEdit.amount,2)+"\n  after edit:     "+r+t("number")(c.bid.amount,2)),e.goods_description||(o+="\nGoods description\n  before edit:    "+g.bidToEdit.goods_description+"\n  after edit:     "+c.bid.goods_description),e.maturity||(o+="\nMaturity\n  before edit:    "+p(g.bidToEdit.maturity)+"\n  after edit:     "+p(c.bid.maturity)),e.created_at||(o+="\nDate created\n  before edit:    "+p(g.bidToEdit.created_at)+"\n  after edit:     "+p(c.bid.created_at)),e.requested_at||(o+="\nDate requested\n  before edit:    "+p(g.bidToEdit.requested_at)+"\n  after edit:     "+p(c.bid.requested_at)),e.downloaded||(o+="\nDownloaded\n  before edit:    "+g.bidToEdit.downloaded+"\n  after edit:     "+g.formM.bid.downloaded),o}function b(){return{amount:g.bidToEdit.amount===c.bid.amount,goods_description:g.bidToEdit.goods_description===c.bid.goods_description,downloaded:g.bidToEdit.downloaded===c.bid.downloaded,created_at:angular.equals(g.bidToEdit.created_at,c.bid.created_at),requested_at:angular.equals(g.bidToEdit.requested_at,c.bid.requested_at),maturity:angular.equals(g.bidToEdit.maturity,c.bid.maturity)}}var g=this;g.formM=c;var v="New Bid Request";u(),g.openDatePicker=function(e){r.each(g.datePickerIsOpen,function(t,o){g.datePickerIsOpen[o]=e===o})},g.isValid=function(t,r){return o(e,"bidForm",t,r)},g.amountGetterSetter=function(e){return arguments.length?void(/[\d,\.]+/.test(e)?g.formM.bid.amount=Number(e.replace(/,/g,"")):g.formM.bid.amount=null):g.formM.bid.amount?t("number")(g.formM.bid.amount,2):null},g.toggleShow=function(e){g.formM.showBidForm=g.formM.amount&&g.formM.number&&!g.formM.showBidForm,g.formM.showBidForm?(g.showAllocateFx=!1,g.title="Dismiss",c.bid.goods_description=c.goods_description,g.formM.bid.amount=g.formM.existingBids.length?null:c.amount):u(e)},g.editBidInvalid=function(e){return r.isEmpty(g.bidToEdit)?!0:e.$invalid?!0:r.all(b())},g.onEditBid=function(e,t,o){o.$setPristine(),g.formM.showEditBid=!0,g.formM.showBidForm=!1,g.toggleShow(),g.bidToEdit=angular.copy(e),g.bidToEdit.$index=t,f()},g.trashBid=function(e){function o(){a.showDialog({text:"Bid delete successfully:"+r,title:"Bid for "+s+" deleted successfully",infoOnly:!0}),c.setBids()}u();var r="\n\nApplicant  : "+e.applicant+"\nForm M     : "+e.form_m_number+"\nBid Amount : "+e.currency+" "+t("number")(e.amount,2),s='"'+e.form_m_number+'"';a.showDialog({text:"Sure you want to delete bid:"+r,title:"Delete bid for "+s}).then(function(t){t&&n["delete"](e).$promise.then(o,function(e){i(e)})})},g.editBid=function(){function e(){var e=angular.copy(g.bidToEdit);o.goods_description||(e.update_goods_description=!0,c.goods_description=c.bid.goods_description),r.each(c.bid,function(t,o){("created_at"===o||"requested_at"===o||"maturity"===o)&&(t=d(t)),e[o]=t}),n.put(e).$promise.then(function(){a.showDialog({title:t,text:"Edit successful: "+s,infoOnly:!0}),u(),c.setBids()},function(e){i(e)})}var t='Edit bid "'+g.bidToEdit.form_m_number+'"',o=b(),s=h(o);a.showDialog({title:t,text:"Are you sure you want to edit Bid:"+s}).then(function(t){t?e():f()})},g.viewBidDetail=function(e){u(),m.showDialog({bid:e})},g.allocateFx=function(e){g.formM.showBidForm=!1,g.title=v,g.initialBidProps={currency:c.currency,content_type:e.ct_url,object_id:e.id},g.allocationTitle="bid amount: "+t("number")(e.amount,2),g.showAllocateFx=!0},g.onFxAllocated=function(e){function o(o){return e.currency_data.code+" "+t("number")(o,2)}var r="\nDeal number     : "+e.deal_number+"\nDeal date       : "+t("date")(e.allocated_on,"dd-MMM-yyyy")+"\nAmount allocated: "+o(e.amount_allocated)+"\nAmount utilized : "+o(e.amount_utilized)+"\nDate utilized   : "+t("date")(e.utilized_on,"dd-MMM-yyyy");a.showDialog({title:"Allocation success",text:r,infoOnly:!0}),u(),c.setBids()},g.dismissShowAllocateFxForm=function(){g.showAllocateFx=!1},e.$watch(function(){return c},function(t){c.bidForm=e.bidForm,t&&(t.amount&&t.number||u(c.bidForm))},!0)}var i=angular.module("lc-bid",["add-fx-allocation","lc-bid-request"]);i.directive("lcBid",r),r.$inject=[],i.controller("LcBidDirectiveController",n),n.$inject=["$scope","$filter","formFieldIsValid","underscore","LcBidRequest","xhrErrorDisplay","confirmationDialog","formMObject","resetForm2","moment","toISODate","ViewBidDetail"]},function(e,t,o){"use strict";function r(){return{restrict:"A",templateUrl:o(5).buildUrl("form-m/add-form-m/comment/comment.html"),scope:!0,controller:"FormMCommentDirectiveController as formMComment"}}function n(e,t,o,r,n,i){function a(e){c.title=s,c.formM.showCommentForm=!1,c.formM.showEditComment=!1,c.commentToEdit=null,n.commentText=null,e&&i(e)}var c=this;c.formM=n;var s="Add comment",l=40;a(),c.isValid=function(o,r){return t(e,"commentForm",o,r)},c.toggleShow=function(e){c.formM.showCommentForm=n._id&&!c.formM.showCommentForm,c.formM.showCommentForm?c.title="Dismiss":a(e)},c.editCommentInvalid=function(e){return o.isEmpty(c.commentToEdit)||e.$invalid?!0:c.commentToEdit.text===n.commentText},c.onCommentDblClick=function(e){c.formM.showEditComment=!0,c.formM.showCommentForm=!1,c.toggleShow(),c.commentToEdit=angular.copy(e),n.commentText=c.commentToEdit.text},c.viewComment=function(e){r.showDialog({title:'View comment "'+e.text.slice(0,l)+'"',text:e.text,infoOnly:!0})},c.editComment=function(e,t){n.editComment(e,c.commentToEdit).then(function(){a(t)})},c.addComment=function(e,t){n.addComment(e).then(function(){a(t)})},e.$watch(function(){return n},function(t){n.commentForm=e.commentForm,t&&(t.amount&&t.number||a(n.commentForm))},!0)}var i=angular.module("form-m-comment",["rootApp","comment-service"]);i.directive("formMComment",r),r.$inject=[],i.controller("FormMCommentDirectiveController",n),n.$inject=["$scope","formFieldIsValid","underscore","confirmationDialog","formMObject","resetForm2"]},function(e,t,o){"use strict";function r(e){e.state("form_m.bids",{kanmiiTitle:"Bids",views:{bids:{template:o(14),controller:"BidRequestController as bidHome"}}})}function n(e,t,o,r,n,i,a,c,s){function l(){p.selectedBids={},p.selectedDownloadedBids={},p.bidRequests=[],p.paginationHooks={},arguments.length||e.pending().$promise.then(function(e){m(e)})}function d(e){o.get(e).then(function(e){m(e.data)})}function m(e){p.bidRequests=e.results,p.paginationHooks={next:e.next,previous:e.previous,count:e.count}}function u(e){e&&!i.isEmpty(e)&&i.each(e,function(e,t){var o=f(t);o&&o.downloaded&&(p.selectedDownloadedBids[t]=e)})}function f(e){for(var t=0;t<p.bidRequests.length;t++){var o=p.bidRequests[t];if(o.id===+e)return o}return null}var p=this;l(),p.rowDblClickCb=function(e){t.goToFormM(e.form_m_number)},p.getBidsOnNavigation=d,p.onBidsSearched=function(e){l(!1),m(e)},t.$watch(function(){return p.searchedBidResult},function(e){e&&m(e)});var h=r(n.lcBidRequestDownloadUrl);p.downloadUrl=function(){if(!i.isEmpty(p.selectedBids)){var e=[];return i.each(p.selectedBids,function(t,o){t===!0&&e.push(o)}),e.length?h.search({bid_ids:e}).toString():null}return null},p.downloadBtnDisabled=function(){return i.isEmpty(p.selectedBids)?!0:!i.any(p.selectedBids,function(e){return e===!0})},p.onSelectedBidsChanged=u,p.markRequestedBtnDisabled=function(){if(i.isEmpty(p.selectedDownloadedBids))return!0;for(var e in p.selectedBids)if(!(e in p.selectedDownloadedBids)&&p.selectedBids[e])return!0;return!i.any(p.selectedDownloadedBids,function(e){return e===!0})},p.markRequested=function(){var t=[];i.each(p.selectedDownloadedBids,function(o,r){if(o){var n=f(r);n&&(n.requested_at=a(new Date),t.push(e.put(n).$promise))}}),t.length&&s.all(t).then(function(){l()})},p.refreshPage=function(){p.downloadBtnDisabled()||c(function(){l()},3e3)}}o(12);var i=angular.module("form-m-bids",["ui.router","lc-bid-request","rootApp","kanmii-URI","search-bids"]);i.config(r),r.$inject=["$stateProvider"],i.controller("BidRequestController",n),n.$inject=["LcBidRequest","$scope","$http","kanmiiUri","urls","underscore","formatDate","$timeout","$q"],o(15)},function(e,t,o){"use strict";function r(){return{restrict:"AE",template:o(13),scope:!0,bindToController:{onBidsSearched:"&"},controller:"searchBidsController as searchBids"}}function n(e,t,o,r,n,i){function a(){c.searchParams={pending:!1}}var c=this;c.showForm=!0,a(),c.toggleShow=function(e){c.showForm=!c.showForm,c.showForm||c.clearForm(e)},c.validators={applicant:{test:function(){return t.isObject(c.searchParams.applicant)}},currency:{test:function(){return t.isObject(c.searchParams.currency)}}},c.getCurrency=r,c.getApplicant=o,c.datePickerIsOpen=!1,c.openDatePicker=function(){c.datePickerIsOpen=!0},c.clearForm=function(e){n(e),a()},c.searchBids=function(t){var o=angular.copy(t);o.applicant=o.applicant?/\d+$/.exec(o.applicant.url)[0]:null,o.currency=o.currency?o.currency.code:null,o.created_at=o.created_at?i(o.created_at):null,o.pending||delete o.pending,e.getPaginated(o).$promise.then(function(e){c.onBidsSearched({searchResult:e})})}}var i=angular.module("search-bids",["customer","lc-bid-request","rootApp"]);i.directive("searchBids",r),r.$inject=[],i.controller("searchBidsController",n),n.$inject=["LcBidRequest","underscore","getTypeAheadCustomer","getTypeAheadCurrency","resetForm2","toISODate"]},function(e,t){e.exports='<div class="search-bids-directive"><div class="search-bid-toggle-show"><div ng-click="searchBids.toggleShow(searchBidsForm)" class="form-m-add-on-toggle clearfix"><span class="form-m-add-on-show-helper" ng-if="searchBids.showForm"></span><div class="form-m-add-on-show-icon form-m-bid-add-on-show-icon"><span ng-class="[\'glyphicon\', {\'glyphicon-chevron-down\': !searchBids.showForm, \'glyphicon-chevron-up\': searchBids.showForm}]"></span> Search Bids</div></div></div><form class="form-horizontal" name="searchBidsForm" role="form" autocomplete="off" ng-show="searchBids.showForm" ng-submit="searchBids.searchBids(searchBids.searchParams)"><div class="form-group form-m-group" control-has-feedback=""><label for="form-m-number" class="control-label col-sm-3">Form M Number</label><div class="col-sm-9"><input type="text" class="form-control" name="formMNumber" ng-model="searchBids.searchParams.mf" id="form-m-number" to-upper="" ng-pattern="/(?:mf)?\\d{3,}/i" maxlength="13"></div></div><div class="form-group applicant-group" control-has-feedback=""><label for="applicant" class="control-label col-sm-3">Applicant</label><div class="col-sm-9"><input type="text" class="form-control" name="applicant" ng-model="searchBids.searchParams.applicant" id="applicant" ng-minlength="3" ng-pattern="searchBids.validators.applicant" typeahead-min-length="3" uib-typeahead="applicant as applicant.name for applicant in searchBids.getApplicant($viewValue)" typeahead-select-on-blur="true" typeahead-select-on-exact="true"></div></div><div class="form-group currency-group" control-has-feedback=""><label for="currency" class="control-label col-sm-3">Currency</label><div class="col-sm-9"><input type="text" class="form-control" name="currency" ng-model="searchBids.searchParams.currency" id="currency" maxlength="3" ng-pattern="searchBids.validators.currency" autocomplete="off" uib-typeahead="currency as currency.code for currency in searchBids.getCurrency($viewValue)" typeahead-select-on-blur="true" typeahead-select-on-exact="true"></div></div><div class="form-group amount-group" control-has-feedback=""><label for="amount" class="control-label col-sm-3">Amount</label><div class="col-sm-9"><input type="text" class="form-control" name="amount" ng-model="searchBids.searchParams.amount" id="amount" number-format=""></div></div><div class="form-group created-date-group" control-has-feedback="" feedback-after=".input-group-addon"><label for="created-at" class="control-label col-sm-3">Created At</label><div class="col-sm-9"><div class="input-group"><input type="text" class="form-control" name="createdAt" ng-model="searchBids.searchParams.created_at" id="created-at" uib-datepicker-popup="dd-MMM-yyyy" is-open="searchBids.datePickerIsOpen"> <span class="input-group-addon" ng-click="searchBids.openDatePicker($event)"><i class="glyphicon glyphicon-calendar"></i></span></div></div></div><div class="form-group lc-number-group"><label for="lc-number" class="control-label col-sm-3">LC Number</label><div class="col-sm-9"><input type="text" class="form-control" name="lcNumber" ng-model="searchBids.searchParams.lc_number" id="lc-number" to-upper="" maxlength="16"></div></div><div class="form-group pending-group"><label for="pending" class="control-label col-sm-3">Pending only</label><div class="col-sm-9"><input type="checkbox" name="pending" ng-model="searchBids.searchParams.pending" id="pending"></div></div><div class="form-group submit-group"><div class="col-sm-9 col-sm-offset-3"><div class="clearfix"><div class="pull-left"><input type="submit" class="btn btn-info" value="Search Bids" ng-disabled="searchBidsForm.$invalid"></div><div class="pull-right" style="text-align: right"><input type="button" class="btn btn-warning" value="Clear All" ng-click="searchBids.clearForm(searchBidsForm)"></div></div></div></div></form></div>'},function(e,t){e.exports='<div class="list-bid-view"><div class="row" style="margin-bottom: 30px; margin-top: 10px"><div class="col-sm-6"><div search-bids="" on-bids-searched="bidHome.onBidsSearched(searchResult)"></div></div><div class="col-sm-6"><div class="action-buttons" style="text-align: right;"><a class="btn btn-success" ng-href="{$bidHome.downloadUrl()$}" ng-disabled="bidHome.downloadBtnDisabled()" ng-click="bidHome.refreshPage()">Download</a> <button type="button" name="bid-home-mark-as-requested-btn" class="btn btn-success" ng-click="bidHome.markRequested()" ng-disabled="bidHome.markRequestedBtnDisabled()">Mark as requested</button></div></div></div><div display-pending-bid="" pending-bids="bidHome.bidRequests" pager-object="bidHome.paginationHooks" update-collection="bidHome.getBidsOnNavigation(linkUrl)" pagination-size="20" selected-bids="bidHome.selectedBids" on-selected-bids-changed="bidHome.onSelectedBidsChanged(newSelections)" on-row-dbl-click="bidHome.rowDblClickCb(bid)" table-caption="bidHome.tableCaption"></div></div>'},function(e,t,o){"use strict";function r(){return{restrict:"EA",templateUrl:i.buildUrl("form-m/bids/display-pending-bid/display-pending-bid.html"),scope:!0,bindToController:{bids:"=pendingBids",updateCollection:"&",onSelectedBidsChanged:"&",pager:"=pagerObject",onDblClick:"&onRowDblClick",paginationSize:"=",selectedBids:"="},controller:"displayPendingBidDirectiveCtrl as bidTable"}}function n(e,t,o){function r(t,o,r){c.count=r;var n=Math.ceil(r/c.paginationSize),i=e(t,o,n);c.nextPageLink=t,c.prevPageLink=o,c.linkUrls=i.linkUrls,c.currentLink=i.currentLink,c.rowIndexOffset=(c.currentLink-1)*c.paginationSize}function n(e){c.updateCollection({linkUrl:e})}function i(){c.bids.forEach(function(e){e.highlighted=!1})}function a(e){e.downloaded||(i(),e.highlighted=!o.any(c.bids,function(e){return e.checked}))}var c=this;c.selectedBids={},c.onUpdateCollection=n,t.$watch(function(){return c.pager},function(e){e&&!o.isEmpty(e)&&r(e.next,e.previous,e.count)}),c.modelRowClicked=a,c.onRowDblClick=function(e){c.onDblClick({bid:e})},t.$watch(function(){return c.selectedBids},function(e){c.onSelectedBidsChanged({newSelections:e}),e&&!o.isEmpty(e)&&(o.each(e,function(e,t){for(var o=0;o<c.bids.length;o++){var r=c.bids[o];r.id===+t&&(r.checked=e)}}),c.toggleAll=o.all(c.bids,function(e){return e.checked===!0}))},!0),c.toggleAll=!1,c.toggleAllClicked=function(){c.bids.forEach(function(e){c.selectedBids[e.id]=!e.requested_at&&c.toggleAll})}}var i=o(5),a=angular.module("form-m-bids");a.directive("displayPendingBid",r),a.controller("displayPendingBidDirectiveCtrl",n),n.$inject=["pagerNavSetUpLinks","$scope","kanmiiUnderscore"]},function(e,t,o){"use strict";function r(e){e.state("form_m.list",{kanmiiTitle:"Form M List",views:{listFormM:{template:o(17),controller:"FormMListController as formMList"}}})}function n(e,t,o,r){function n(e){a.formMs=e.results,a.paginationHooks={next:e.next,previous:e.previous,count:e.count}}function i(e){r.get(e).then(function(e){n(e.data)})}var a=this;a.modelManager=o,a.modelRowDblClick=function(e){t.goToFormM(e.number)},a.updateFormMs=n,a.paginationHooks=[],a.formMs=[],e.getNoLcAttached().$promise.then(function(e){n(e)}),a.tableCaption="Form M",a.getFormMCollectionOnNavigation=i,a.searchedFormMResult=null,t.$watch(function(){return a.searchedFormMResult},function(e){e&&n(e)})}var i=angular.module("list-form-m",["rootApp","ui.router","form-m-service","search-form-m","model-table","customer","add-form-m"]);
i.config(r),r.$inject=["$stateProvider"],i.controller("FormMListController",n),n.$inject=["FormM","$scope","formMModelManager","$http"]},function(e,t){e.exports='<div class="manage-form-m-tab-content"><div class="row" style="margin-bottom: 30px; margin-top: 10px"><div class="col-sm-6"><div search-mf="" on-mf-search="formMList.updateFormMs(searchResult)"></div></div></div><div model-table="" model-collection="formMList.formMs" table-model-manager="::formMList.modelManager" table-caption="::formMList.tableCaption" pagination-size="20" update-collection="formMList.getFormMCollectionOnNavigation(linkUrl)" pager-object="formMList.paginationHooks" on-row-dbl-click-callback="formMList.modelRowDblClick(rowModel)"></div></div>'},function(e,t,o){"use strict";function r(e,t,r,n,i,a){function c(o){function r(e){1===e.length&&c.resolve({uploaded:e[0]})}function n(e){t(e),c.reject(e)}var c=i.defer(),s=o.mf.trim();return a.getPaginated({number:s}).$promise.then(function(t){1===t.count?c.resolve({number:t.results[0].number}):e.query({mf:s}).$promise.then(r,n)},n),c.promise}function s(){function e(){var e=i.defer();return r.showModal({templateUrl:o(5).buildUrl("form-m/search-detailed-or-uploaded-form-m/search-detailed-or-uploaded-form-m-modal.html"),controller:"SearchDetailedOrUploadedFormMServiceModalCtrl as searchUploadedFormMModal"}).then(function(t){t.element.dialog({dialogClass:"no-close",modal:!0,minWidth:500,title:"Search Form M",close:function(){t.controller.close()}}),t.close.then(function(t){t&&angular.isObject(t)&&!n.isEmpty(t)&&e.resolve(c(t))})}),e.promise}var t=this;t.searchWithModal=e}return new s}function n(e,t,o){function r(){i.searchParams={}}function n(e){t(e,o,".form-control",r),e.$invalid=!1,e.$error={}}var i=this;r(),i.close=e,i.reset=n}var i=angular.module("search-detailed-or-uploaded-form-m",["upload-form-m-service","toggle-dim-element","form-m-service"]);i.factory("SearchDetailedOrUploadedFormMService",r),r.$inject=["UploadFormM","xhrErrorDisplay","ModalService","underscore","$q","FormM"],i.controller("SearchDetailedOrUploadedFormMServiceModalCtrl",n),n.$inject=["close","resetForm","$element"]},function(e,t,o){"use strict";function r(){return{restrict:"AE",template:o(20),scope:!0,bindToController:{onMfSearch:"&"},controller:"searchFormMController as searchMf"}}function n(e,t,o,r,n,i){function a(){c.searchParams={cancelled:!1}}var c=this;c.showForm=!0,a(),c.toggleShow=function(e){c.showForm=!c.showForm,c.showForm||c.clearForm(e)},c.getCurrency=r,c.getApplicant=o,c.datePickerIsOpen=!1,c.openDatePicker=function(){c.datePickerIsOpen=!0},c.clearForm=function(e){n(e),a()},c.searchMf=function(t){var o=angular.copy(t);o.applicant_id=o.applicantObj?/\d+$/.exec(o.applicantObj.url)[0]:null,o.currency=o.currency?o.currency.code:null,o.created_at=o.created_at?i(o.created_at):null,o.cancelled||delete o.cancelled,e.getPaginated(o).$promise.then(function(e){c.onMfSearch({searchResult:e})})}}var i=angular.module("search-form-m",["customer","form-m-service","rootApp","complex-object-validator"]);i.directive("searchMf",r),r.$inject=[],i.controller("searchFormMController",n),n.$inject=["FormM","underscore","getTypeAheadCustomer","getTypeAheadCurrency","resetForm2","toISODate"]},function(e,t){e.exports='<div class="search-mf-directive"><div class="search-mf-toggle-show"><div ng-click="searchMf.toggleShow(searchMfForm)" class="form-m-add-on-toggle clearfix"><span class="form-m-add-on-show-helper" ng-if="searchMf.showForm"></span><div class="form-m-add-on-show-icon"><span ng-class="[\'glyphicon\', {\'glyphicon-chevron-down\': !searchMf.showForm, \'glyphicon-chevron-up\': searchMf.showForm}]"></span> Search Form M</div></div></div><form class="form-horizontal" name="searchMfForm" role="form" autocomplete="off" ng-show="searchMf.showForm" ng-submit="searchMf.searchMf(searchMf.searchParams)"><div class="form-group form-m-number-group" control-has-feedback=""><label for="form-m-number" class="control-label col-sm-3">Form M Number</label><div class="col-sm-9"><input type="text" class="form-control" name="formMNumber" ng-model="searchMf.searchParams.number" id="form-m-number" to-upper="" ng-pattern="/(?:mf)?\\d{3,}/i" maxlength="13"></div></div><div class="form-group applicant-group" control-has-feedback=""><label for="applicant" class="control-label col-sm-3">Applicant</label><div class="col-sm-9"><input type="text" class="form-control" name="applicant" ng-model="searchMf.searchParams.applicantObj" id="applicant" ng-minlength="3" autocomplete="off" typeahead-min-length="3" uib-typeahead="applicant as applicant.name for applicant in searchMf.getApplicant($viewValue)" typeahead-select-on-blur="true" typeahead-select-on-exact="true"></div></div><div class="form-group currency-group" control-has-feedback=""><label for="currency" class="control-label col-sm-3">Currency</label><div class="col-sm-9"><input type="text" class="form-control" name="currency" ng-model="searchMf.searchParams.currency" id="currency" maxlength="3" autocomplete="off" uib-typeahead="currency as currency.code for currency in searchMf.getCurrency($viewValue)" typeahead-select-on-blur="true" typeahead-select-on-exact="true"></div></div><div class="form-group amount-group" control-has-feedback=""><label for="amount" class="control-label col-sm-3">Amount</label><div class="col-sm-9"><input type="text" class="form-control" name="amount" ng-model="searchMf.searchParams.amount" id="amount" number-format=""></div></div><div class="form-group created-date-group" control-has-feedback="" feedback-after=".input-group-addon"><label for="created-at" class="control-label col-sm-3">Created At</label><div class="col-sm-9"><div class="input-group"><input type="text" class="form-control" name="createdAt" ng-model="searchMf.searchParams.created_at" id="created-at" uib-datepicker-popup="dd-MMM-yyyy" is-open="searchMf.datePickerIsOpen"> <span class="input-group-addon" ng-click="searchMf.openDatePicker($event)"><i class="glyphicon glyphicon-calendar"></i></span></div></div></div><div class="form-group lc-number-group"><label for="lc-number" class="control-label col-sm-3">LC Number</label><div class="col-sm-9"><input type="text" class="form-control" name="lcNumber" ng-model="searchMf.searchParams.lc_number" id="lc-number" to-upper="" maxlength="16"></div></div><div class="form-group cancelled-group"><label for="cancelled" class="control-label col-sm-3">Include cancelled</label><div class="col-sm-9"><input type="checkbox" name="cancelled" ng-model="searchMf.searchParams.cancelled" id="cancelled"></div></div><div class="form-group submit-group"><div class="col-sm-9 col-sm-offset-3"><div class="clearfix"><div class="pull-left"><input type="submit" class="btn btn-info" value="Search Form M" ng-disabled="searchMfForm.$invalid"></div><div class="pull-right" style="text-align: right"><input type="button" class="btn btn-warning" value="Clear All" ng-click="searchMf.clearForm(searchMfForm)"></div></div></div></div></form></div>'},function(e,t,o){"use strict";function r(e){e.state("form_m.upload",{kanmiiTitle:"Form M Upload",views:{uploadFormM:{template:o(23),controller:"UploadFormMController as uploadFormM"}}})}function n(e,t,o,r){function n(e){a.formMShowIndicator=!1,a.indicateError=!1,a.formMIsUploading=!1,a.uploadIndicationText="Uploading Form Ms.........please wait",a.uploadFormMText="",e&&(e.$setPristine(),e.$setUntouched())}function i(){a.formMShowIndicator=!1,a.formMIsUploading&&n(r.uploadFormMForm)}var a=this;a.datePrompt="Date must be in format dd-mm-yyyy e.g 31-01-2015",n(),a.dismissIndicator=function(){i()},a.uploadFormM=function(r){function n(e){var t=/(\d{2})\D(\d{1,2})\D(\d{4})/,o=t.exec(e);if(!o)return null;var r=+o[2].trim();return r>12?null:o[3]+"-"+r+"-"+o[1]}function i(e){var t=e.created_data,o=t.length,r=h.length-o;a.uploadIndicationText="Done Uploading form Ms\n======================\nTotal new form Ms created: "+o+"\n",r&&(a.uploadIndicationText+="Total not created (uploaded previously): "+r)}function c(e){a.formMIsUploading=!1,a.indicateError=!0,a.uploadIndicationText="Error uploading form!",t(e)}a.formMIsUploading=!0,a.formMShowIndicator=!0;var s,l,d,m,u,f={};try{Papa.parse(r,{delimiter:"	",header:!0,step:function(e){if(s=e.data[0],l=s["MF NUM"].trim(),m=s["BA NUM"].trim(),u=n(s["DATE SUBMITTED"]),!u)throw new Error('Error in form M date: "'+l+'"\n'+a.datePrompt);d={ba:m,mf:l,ccy:s.CURRENCY.trim(),applicant:s["APPLICANT NAME"].trim(),fob:s.FOB.replace(/[,\s]/g,""),cost_freight:s["COST AND FREIGHT"].replace(/[,\s]/g,""),submitted_at:u,validated_at:u,goods_description:s.DESCS.trim()},o.has(f,l)?"Validated"===s.STAX.trim()?(d.submitted_at=f[l].submitted_at,f[l]=d):"Submitted"===s.STAX.trim()&&(f[l].submitted_at=d.submitted_at):16===m.length&&(f[l]=d)}})}catch(p){return a.formMIsUploading=!1,a.indicateError=!0,void(a.uploadIndicationText=p.message)}var h=o.values(f);e.save({uploaded:h,likely_duplicates:!0}).$promise.then(i,c)}}o(22);var i=o(7),a=angular.module("upload-form-m",["rootApp","ui.router","upload-form-m-service","kanmii-underscore"]);a.config(i.interpolateProviderConfig),a.config(r),r.$inject=["$stateProvider"],a.controller("UploadFormMController",n),n.$inject=["UploadFormM","xhrErrorDisplay","kanmiiUnderscore","$scope"]},function(e,t,o){"use strict";function r(e,t,r,n,i){function a(o){function r(e){a.resolve(e)}function n(e){t(e),a.reject(e)}var a=i.defer(),c=angular.copy(o);return c.applicant&&(c.applicant=c.applicant.name),c.currency&&(c.currency=c.currency.code),e.query(c).$promise.then(r,n),a.promise}function c(){function e(){var e=i.defer();return r.showModal({templateUrl:o(5).buildUrl("form-m/upload-form-m/search-uploaded-form-m/search-uploaded-form-m-modal.html"),controller:"SearchUploadedFormMServiceModalCtrl as searchUploadedFormMModal"}).then(function(t){t.element.dialog({dialogClass:"no-close",modal:!0,minWidth:600,minHeight:250,title:"Search Uploaded Form M",close:function(){t.close.then()}}),t.close.then(function(t){t&&angular.isObject(t)&&!n.isEmpty(t)&&e.resolve(a(t))})}),e.promise}var t=this;t.searchWithModal=e}return new c}function n(e,t,o){function r(){a.searchParams={}}function n(e){t(e,o,".form-control",r),e.$invalid=!1,e.$error={}}function i(t){e(t)}var a=this;r(),a.close=e,a.reset=n,a.submitSearchParams=i}var i=angular.module("search-uploaded-form-m",["kanmii-underscore","upload-form-m-service","toggle-dim-element"]);i.factory("SearchUploadedFormMService",r),r.$inject=["UploadFormM","xhrErrorDisplay","ModalService","kanmiiUnderscore","$q"],i.controller("SearchUploadedFormMServiceModalCtrl",n),n.$inject=["close","resetForm","$element"]},function(e,t){e.exports='<div class="upload-form-m-tab-content" ng-keypress="uploadFormM.dismissIndicatorEvent($event)"><form class="upload-form-m-form" role="form" name="uploadFormMForm" ng-submit="uploadFormM.uploadFormM(uploadFormM.uploadFormMText, uploadFormMForm)"><div class="form-group upload-form-m-text-group"><pre ng-class="[\'upload-form-m-indicator\', {\'error-indicator\': uploadFormM.indicateError}]" ng-show="uploadFormM.formMShowIndicator">{$uploadFormM.uploadIndicationText$}\r\n        <span class="dismiss" data-toggle="tooltip" title="Dismiss" ng-click="uploadFormM.dismissIndicator()">x</span>\r\n      </pre><label for="upload-form-m" class="control-label">{$uploadFormM.datePrompt$}</label> <textarea name="upload-form-m" id="upload-form-m" required="" ng-model="uploadFormM.uploadFormMText" ng-class="[\'form-control\', \'upload-form-m\', {\'form-m-is-uploading\':uploadFormM.formMIsUploading}]" ng-readonly="uploadFormM.formMIsUploading"></textarea></div><div class="upload-form-m-submit" style="text-align: center"><button type="submit" class="btn btn-success" ng-disabled="uploadFormMForm.$invalid || uploadFormM.formMIsUploading">Upload</button></div></form></div>'},function(e,t){e.exports='<div class="form-m-home-view"><div uib-tabset=""><div uib-tab="" ng-repeat="(key, tab) in tabs" heading="{$tab.title$}" active="tab.active" select="tab.select()"><div class="" ui-view="{$tab.viewName$}"></div></div></div></div>'},function(e,t,o){"use strict";function r(e){e.state("lc",{url:"/lc",kanmiiTitle:"Letter of credit",templateUrl:o(5).buildUrl("lc/lc.html"),controller:"LetterOfCreditController as lcHome"})}function n(e,t){var o=this;o.searchLc=function(){e.searchWithModal().then(function(e){var o=e.results;if(o.length&&1===o.length){var r=o[0];t.go("lc_detail",{lc_number:r.lc_number,lc:r})}})}}var i=o(7),a=angular.module("lc",["ui.router","model-table","rootApp","search-lc","lc-detail"]);a.config(i.interpolateProviderConfig),a.config(r),r.$inject=["$stateProvider"],a.controller("LetterOfCreditController",n),n.$inject=["SearchLc","$state"],o(26),o(27)},function(e,t,o){"use strict";function r(e){e.state("lc_detail",{url:"/lc/:lc_number",params:{lc:null},kanmiiTitle:"Letter of credit",templateUrl:o(5).buildUrl("lc/lc-detail/lc-detail.html"),controller:"LetterOfCreditDetailController as lcDetail"})}function n(e,t,o,r,n,i,a,c,s,l,d,m){function u(){function r(e){return e?e.filter(function(e){return!e.closed_at}):[]}e.lc?(f.lc=e.lc,f.lcIssues=r(f.lc.issues)):t.getPaginated({lc_number:e.lc_number}).$promise.then(function(e){e.count?(f.lc=e.results[0],f.lcIssues=r(f.lc.issues)):o.go("lc")}),f.lcForm={},f.alertIsShown=!1,f.issue={}}var f=this;u(),f.issueDateGetterSetter=function(){return f.lc&&f.lc.estb_date?n("date")(f.lc.estb_date,"dd-MMM-yyyy"):void 0},f.expiryDateGetterSetter=function(){return f.lc&&f.lc.expiry_date?n("date")(f.lc.expiry_date,"dd-MMM-yyyy"):void 0},f.saveIssue=function(e,t){function o(e){f.lcIssues.unshift({issue_text:e.issue_text,issue:e.issue,id:e.id,mf:e.mf}),f.issue={},f.lc.applicant_data||(f.lc.applicant_data=i),t.$setPristine(),t.$setUntouched()}function r(e){var t=null;e.data.form_m_creation_errors&&(t=m,delete e.data.form_m_creation_errors),s(e,t)}if(e&&!c.isEmpty(e)){var n={issue:e.issue.url,mf:f.lc.mf,lc_number:f.lc.lc_number,get_or_create_form_m:!0},i=e.applicant;i&&!c.isEmpty(i)&&(n.form_m_data={applicant:i.url,currency:f.lc.ccy_data.url,amount:f.lc.lc_amt_org_ccy,lc:f.lc.url,number:f.lc.mf}),a.save(n).$promise.then(o,r)}},f.closeIssue=function(e){e.closed_at=l(new Date),a.put(e).$promise.then(function(){f.lcIssues=f.lcIssues.filter(function(t){return t.id!==e.id})},function(e){s(e)})},f.replaceLc=function(e){t.getPaginated({lc_number:e}).$promise.then(function(e){if(e.count){var t=e.results[0];o.go(".",{lc_number:t.lc_number,lc:t})}else f.alertIsShown=!0})},f.replaceLcFormInvalid=function(e,t){return e||-1!==f.lc.lc_number.toLowerCase().indexOf(t.toLowerCase())},f.customerAdded=function(e){f.issue.applicant=e},f.getApplicant=r,f.getIssue=function(e){return i({text:e,exclude_form_m_issues:f.lc.mf})},f.addCustomer=function(){d.save({name:f.lc.applicant}).$promise.then(function(e){f.issue.applicant=e,f.lc.applicant_data=e})},f.closeAlert=function(){f.alertIsShown=!1}}var i=o(7),a=angular.module("lc-detail",["ui.router","rootApp","lc-service","lc-issue-service","kanmii-underscore","customer"]);a.config(i.interpolateProviderConfig),a.config(r),r.$inject=["$stateProvider"],a.controller("LetterOfCreditDetailController",n),n.$inject=["$stateParams","LetterOfCredit","$state","getTypeAheadCustomer","$filter","getTypeAheadLCIssue","LCIssueConcrete","kanmiiUnderscore","xhrErrorDisplay","formatDate","Customer","formMAttributesVerboseNames"]},function(e,t,o){"use strict";function r(e,t,r,n,i,a){function c(t){function o(e){i.resolve(e)}function r(t){e(t),i.reject(t)}var i=n.defer(),c=angular.copy(t);return c.applicant&&(c.applicant=c.applicant.name),c.currency&&(c.currency=c.currency.code),a.getPaginated(c).$promise.then(o,r),i.promise}function s(){function e(e){var a=n.defer();return e=e||{},t.showModal({templateUrl:o(5).buildUrl("lc/search-lc/search-lc.html"),controller:"SearchLcModalCtrl as searchLcModal",inputs:{uiOptions:e.uiOptions}}).then(function(t){t.element.dialog({dialogClass:"no-close",modal:!0,minWidth:600,minHeight:450,title:"Search Letter of credit",open:function(){e.dim&&i.dim(e.parent,e.dimCb)},close:function(){e.dim&&i.unDim(e.parent,e.unDimCb)}}),t.close.then(function(t){t&&angular.isObject(t)&&!r.isEmpty(t)&&a.resolve(c(t)),e.dim&&i.unDim(e.parent,e.unDimCb)})}),a.promise}var a=this;a.searchWithModal=e}return new s}function n(e,t,o,r,n){function i(){s.searchParams={}}function a(e){t(e,o,".form-control",i),e.$invalid=!1,e.$error={}}function c(t){e(t)}var s=this;i(),s.close=e,s.reset=a,s.submitSearchParams=c,s.getApplicant=r,s.getCurrency=n}var i=angular.module("search-lc",["kanmii-underscore","toggle-dim-element","form-m-service","lc-service"]);i.factory("SearchLc",r),r.$inject=["xhrErrorDisplay","ModalService","kanmiiUnderscore","$q","ToggleDimElement","LetterOfCredit"],i.controller("SearchLcModalCtrl",n),n.$inject=["close","resetForm","$element","getTypeAheadCustomer","getTypeAheadCurrency"]},function(e,t){e.exports='<div class="form-m-home-view"><div class="form-m-home-action-buttons btn-group-vertical" role="group"><a class="btn btn-info form-m-home-action-button" ui-sref="lc">Letter of credit</a> <a class="btn btn-info form-m-home-action-button" ui-sref="form_m">Form M</a></div></div>'}]);
//# sourceMappingURL=app.min.js.map
