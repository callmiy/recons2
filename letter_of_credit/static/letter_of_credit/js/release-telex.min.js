$(function(){"use strict";function e(){function e(){var e="",i=/[:F]*50: APPLICANT.*\n(.+)/i.exec(t);i&&(e=i[1].trim());var c="",a=/[:F]*32B: CURRENCY CODE, AMOUNT[.\n\s]*[A-Z]{3}[.\n\s]*([0-9,]+)/i.exec(t);a||(a=/Amount:\s+[\d,]+\s+#([0-9,]+)#/.exec(t)),a&&(c=kanmii.numberFormat(a[1].trim().replace(",",".")));var n="",l=/[:F]*32B: CURRENCY CODE, AMOUNT[.\n\s]*([A-Z]{3})/i.exec(t)||/Currency:\s+([A-Z]{3})/i.exec(t);l&&(n=l[1].trim());var r="",d=/MF20[\dX]+/i.exec(t);d&&(r=d[0]);var o="",s=/ILCL[A-Z]{3}[\d+X]+/i.exec(t);s&&(o=s[0]);var h,p=/[:F]*31D: Date and Place of Expiry[\s.\n]+(\d{6})/i.exec(t);p&&(h=p[1]);var f,u=/[:F]*31C: DATE OF ISSUE[\s.\n]+(\d{6})/i.exec(t);u&&(f=u[1]);var x,m=/[:F]*44C: LATEST DATE OF SHIPMENT[\s.\n]+(\d{6})/i.exec(t);return m&&(x=m[1]),{applicant:e,ccy:n,amount:c,formM:r,issueDate:f,expiryDate:h,shipmentDate:x,lcRef:o}}function i(){if(h.lcRef)if(l.is(":checked")){var e=new RegExp(h.lcRef,"g");t=t.replace(e,h.lcRef.slice(0,4)+"XXXXXXXXXXXX"),a.push("LC reference will be hidden!")}else p+="-"+h.lcRef;h.issueDate&&r.is(":checked")&&(t=t.replace(h.issueDate,"XXXXXX"),a.push("Issue date will be hidden!")),h.expiryDate&&d.is(":checked")&&(t=t.replace(h.expiryDate,"XXXXXX "),a.push("Expiry date will be hidden!")),h.shipmentDate&&o.is(":checked")&&(t=t.replace(h.shipmentDate,"XXXXXX"),a.push("Shipment date will be hidden!"))}var t=s.val().trim(),a=[];if(!t)return null;var n=t.toLowerCase().indexOf("mt700 issue of a documentary credit");-1!==n&&(t=t.slice(n));var h=e(),p=h.applicant+"-"+h.ccy+h.amount+"-"+h.formM;return c.is(":checked")?p+="-"+h.lcRef:i(),p+=".txt",{telex:t,fileName:p,willBeHiddenTexts:a}}var i=$(".draft-control-group"),t=$("#hide-all"),c=$("#show-all"),a=$(".fields-to-hide-checkboxes"),n=a.size(),l=$("#lc-ref-hide"),r=$("#issue-date-hide"),d=$("#expiry-date-hide"),o=$("#shipment-date-hide"),s=$("#telex-text-mt-700"),h=$("#telex-text-mt-700-reformatted"),p=$("#telex-text-mt-700-reformatted-file-name"),f=$($("#hide-telex-variables-confirmation-template").text()).dialog({resizable:!1,height:250,width:400,modal:!0,autoOpen:!1}),u=f.find("#message"),x={text:"Cancel",click:function(){$(this).dialog("close")}};!function(){$(".hide-or-show-all-checkboxes").change(function(){var e=$(this);e.is("#hide-all")?e.is(":checked")&&(a.each(function(){$(this).prop("checked",!0)}),c.prop("checked",!1)):e.is(":checked")&&(a.each(function(){$(this).prop("checked",!1)}),t.prop("checked",!1))}),a.change(function(){0===a.filter(":checked").size()?(t.prop("checked",!1),c.prop("checked",!0)):a.filter(":checked").size()<n?(t.prop("checked",!1),c.prop("checked",!1)):t.prop("checked",!0)}),$("input[name=release-type-radio]").change(function(){var e=$(this);"release-type-draft"===e.prop("id")?i.show():(c.prop("checked",!0).trigger("change"),i.hide())})}(),function(){function i(){p.val(""),h.val("").parent().hide()}$("#save-telex-button").click(function(){i(),u.html("");var t=e();if(t){var c=[x];c.push({text:"Ok",click:function(){var e=new Blob([t.telex],{type:"text/plain;charset=utf-8"});saveAs(e,t.fileName),p.val(t.fileName),h.val(t.telex).parent().show(),kanmii.selectText(p[0]),$(this).dialog("close")}}),t.willBeHiddenTexts.length>0?t.willBeHiddenTexts.forEach(function(e){u.append($("<p>"+e+"</p>"))}):u.append($("<p>Nothing will be hidden. You are releasing authenticated telex?</p>")),f.dialog("option","buttons",c).dialog("open")}else f.dialog("option","buttons",[x]).dialog("open")}),$("#clear-telex-button").click(function(){s.val(""),i()})}()});