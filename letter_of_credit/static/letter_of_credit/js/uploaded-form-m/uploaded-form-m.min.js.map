{"version":3,"sources":["letter_of_credit/static/letter_of_credit/js/uploaded-form-m/uploaded-form-m.js"],"names":["$","parseNumber","val","Number","replace","prePendZeros","length","parseDate","dateRe","RegExp","exec","trim","start","dateFormat","$idUpload","$toUpload","$dateFormat","$textAreaControls","change","this","disabled","filter","size","each","prop","on","data","reportHeaderBeginText","toUpload","Papa","parse","delimiter","header","step","row","push","ba","mf","ccy","CURRENCY","fob","FOB","applicant","bene","submitted_at","goods_description","DESCS","cost_freight","validity_type","status","STAX","e","window","alert","message","JSON","stringify","submit","evt","test","addClass","preventDefault"],"mappings":"AAAAA,EAAG,WAGD,YAQA,SAASC,GAAYC,GACnB,MAAOC,QAAQD,EAAIE,QAAS,SAAU,KAGxC,QAASC,GAAaH,GAEpB,MADAA,GAAM,GAAKA,EACW,IAAfA,EAAII,OAAeJ,EAAM,KAAOA,EAGzC,QAASK,GAAUL,GACjB,GAAIM,GAAS,GAAIC,QAAQ,kCACvBC,EAAOF,EAAOE,KAAMR,EAAIS,QACxBC,EAAQP,EAAcK,EAAM,IAAQ,GAEtC,OAAoB,eAAfG,EAAqCD,EAAQF,EAAM,GAAM,IAAMA,EAAM,GAEnEE,EAAQF,EAAM,GAAM,IAAMA,EAAM,GAtBzC,GAIEG,GAJEC,EAAYd,EAAG,+BACjBe,EAAYf,EAAG,0BACfgB,EAAchB,EAAG,sBACjBiB,EAAoBjB,EAAG,qBAsBzBgB,GAAYE,OAAQ,WAClBL,EAAab,EAAGmB,MAAOjB,KACvB,IAAIkB,IAAYJ,EAAYK,OAAQ,YAAaC,MAEjDL,GAAkBM,KAAM,WACtBvB,EAAGmB,MAAOK,KAAM,WAAYJ,OAIhCN,EAAUW,GAAI,QAAS,WACrB,GAEEC,GAFEC,EAAwB,iCAC1BC,IAGFC,MAAKC,MAAOhB,EAAUZ,MAAME,QAASuB,EAAuB,IAAKhB,OAAOP,QAAS,KAAM,KACrF2B,UAAW,KACXC,QAAQ,EACRC,KAAM,SAAUC,GACdR,EAAOQ,EAAIR,KAAM,EAEjB,KACEE,EAASO,MAELC,GAAIV,EAAM,UAAWf,OACrB0B,GAAIX,EAAM,UAAWf,OACrB2B,IAAKZ,EAAKa,SAAS5B,OACnB6B,IAAKvC,EAAayB,EAAKe,KACvBC,UAAWhB,EAAM,kBAAmBf,OACpCgC,KAAMjB,EAAM,sBAAuBf,OACnCiC,aAAcrC,EAAWmB,EAAM,mBAC/BmB,kBAAmBnB,EAAKoB,MAAMnC,OAC9BoC,aAAc9C,EAAayB,EAAM,qBACjCsB,cAAetB,EAAM,iBAAkBf,OACvCsC,OAAQvB,EAAKwB,KAAKvC,SAGtB,MAAQwC,GACRC,OAAOC,MAAO,uBAAyBF,EAAEG,aAM/CvC,EAAUb,IAAKqD,KAAKC,UAAW5B,MAGjC5B,EAAG,4BAA6ByD,OAAQ,SAAUC,GAE3C,WAAWC,KAAM5C,EAAUb,QAC9BF,EAAG,8BAA+BwB,KAAM,YAAY,GACpDxB,EAAG,YAAauB,KAAM,WACpBvB,EAAGmB,MAAOK,KAAM,YAAY,KAE9BxB,EAAGmB,MAAOyC,SAAU,gCAGpBR,OAAOC,MAAO,6CACdK,EAAIG","file":"letter_of_credit/static/letter_of_credit/js/uploaded-form-m/uploaded-form-m.min.js","sourcesContent":["$( function () {\r\n  /*jshint camelcase:false*/\r\n\r\n  \"use strict\";\r\n\r\n  var $idUpload = $( '#id_upload-lc-register-text' ),\r\n    $toUpload = $( '#id_upload-lc-register' ),\r\n    $dateFormat = $( '[name=date-format]' ),\r\n    $textAreaControls = $( '.text-area-control' ),\r\n    dateFormat\r\n\r\n  function parseNumber(val) {\r\n    return Number( val.replace( /[,\\s]/g, '' ) )\r\n  }\r\n\r\n  function prePendZeros(val) {\r\n    val = '' + val\r\n    return val.length === 4 ? val : '20' + val\r\n  }\r\n\r\n  function parseDate(val) {\r\n    var dateRe = new RegExp( \"(\\\\d+)[^\\\\d](\\\\d+)[^\\\\d](\\\\d+)\" ),\r\n      exec = dateRe.exec( val.trim() ),\r\n      start = prePendZeros( exec[ 3 ] ) + '-'\r\n\r\n    if ( dateFormat === 'mm-dd-yyyy' ) return start + exec[ 1 ] + '-' + exec[ 2 ]\r\n\r\n    return start + exec[ 2 ] + '-' + exec[ 1 ]\r\n  }\r\n\r\n  $dateFormat.change( function () {\r\n    dateFormat = $( this ).val()\r\n    var disabled = !$dateFormat.filter( ':checked' ).size()\r\n\r\n    $textAreaControls.each( function () {\r\n      $( this ).prop( 'disabled', disabled )\r\n    } )\r\n  } )\r\n\r\n  $idUpload.on( 'input', function () {\r\n    var reportHeaderBeginText = 'FORM M PROCESSED ON CBN WINDOW',\r\n      toUpload = [],\r\n      data\r\n\r\n    Papa.parse( $idUpload.val().replace( reportHeaderBeginText, '' ).trim().replace( /\"/g, '' ), {\r\n      delimiter: '\\t',\r\n      header: true,\r\n      step: function (row) {\r\n        data = row.data[ 0 ]\r\n\r\n        try {\r\n          toUpload.push(\r\n            {\r\n              ba: data[ 'BA NUM' ].trim(),\r\n              mf: data[ 'MF NUM' ].trim(),\r\n              ccy: data.CURRENCY.trim(),\r\n              fob: parseNumber( data.FOB ),\r\n              applicant: data[ 'APPLICANT NAME' ].trim(),\r\n              bene: data[ \"BENEFICIARY'S NAME\" ].trim(),\r\n              submitted_at: parseDate( data[ 'DATE SUBMITTED' ] ),\r\n              goods_description: data.DESCS.trim(),\r\n              cost_freight: parseNumber( data[ 'COST AND FREIGHT' ] ),\r\n              validity_type: data[ 'VALIDITY TYPE' ].trim(),\r\n              status: data.STAX.trim()\r\n            }\r\n          )\r\n        } catch ( e ) {\r\n          window.alert( \"Error parsing data\\n\" + e.message )\r\n        }\r\n\r\n      }\r\n    } )\r\n\r\n    $toUpload.val( JSON.stringify( toUpload ) )\r\n  } )\r\n\r\n  $( '.upload-lc-register-form' ).submit( function (evt) {\r\n\r\n    if ( /^\\[\\{\".+/.test( $toUpload.val() ) ) {\r\n      $( '#upload-lc-register-submit' ).prop( 'disabled', true )\r\n      $( 'textarea' ).each( function () {\r\n        $( this ).prop( 'readonly', true )\r\n      } )\r\n      $( this ).addClass( 'ui-widget-overlay ui-front' )\r\n\r\n    } else {\r\n      window.alert( 'Nothing to upload or invalid upload data!' )\r\n      evt.preventDefault()\r\n    }\r\n  } )\r\n} );\r\n"],"sourceRoot":"/source/"}