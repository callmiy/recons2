{"version":3,"sources":["letter_of_credit/static/letter_of_credit/js/process_swift/process_swift.js"],"names":["$","getOperator","$selection","size","getInner","parent","$context","selector","text","find","next","children","processText","html","trim","replace","$processSwift","document","getElementById","submit","evt","preventDefault","file","files","reader","FileReader","readAsText","onload","e","$obj","$swift","target","result","i","is","window","alert","messageSelector","join","each","$td","this","$receiver","$theirRef","$finishedTime","$auth","Date","eq","$verifier","verifierSize","$modifier","modifierSize","$deliveryStatus","deliveryStatus","console","log"],"mappings":"AAAAA,EAAE,WACA,YAiEA,SAASC,GAAYC,GACnB,MAAKA,GAAWC,OACTC,EAASF,EAAWG,SAAU,iDAAiD,GADvD,GAIjC,QAASD,GAASE,EAAUC,EAAUC,GACpC,GAAIN,GAAaI,EAASG,KAAKF,GAAUF,SAASK,OAAOC,SAAS,MAClE,OAAOH,GAAOI,EAAYV,EAAWW,QAAUX,EAGjD,QAASU,GAAYC,GACnB,MAAOA,GAAKC,OAAOC,QAAQ,SAAU,MAAMA,QAAQ,WAAY,KA1EjE,GAAIC,GAAgBC,SAASC,eAAe,gBACzBlB,GAAE,gBAErBA,GAAE,uBAAuBmB,OAAO,SAAUC,GACxCA,EAAIC,gBACJ,IAAIC,GAAON,EAAcO,MAAM,EAC/B,IAAKD,EAAL,CAEA,GAAIE,GAAS,GAAIC,WACjBD,GAAOE,WAAWJ,GAClBE,EAAOG,OAAS,SAAUC,GAIxB,IAAK,GADDC,GAFAC,EAAS9B,EAAE4B,EAAEG,OAAOC,OAAOlB,QAGtBmB,EAAI,EAAGA,EAAIH,EAAO3B,SACzB0B,EAAO7B,EAAE8B,EAAOG,KACZJ,EAAKK,GAAG,UAFqBD,IAGjCJ,EAAO,IAGT,KAAKA,EAEH,WADAM,QAAOC,MAAM,sCAIf,IAAIC,IACF,kDACA,wCACA,gDACAC,KAAK,IAEPT,GAAKpB,KAAK,wDAAwD8B,KAAK,WACrE,GAAIC,GAAMxC,EAAEyC,MAAMpC,SAEdqC,GADOF,EAAI/B,KAAK,sBAAsBD,OAC1BJ,EAASoC,EAAK,6DAI1BG,GAHcD,EAAUlC,OACTJ,EAASsC,EAAUrC,SAASK,OAAQ,kDAAkD,GAC5FN,EAASoC,EAAK,8DAA8D,GACzEpC,EAASoC,EAAK,2DAG1BI,GAFWD,EAAUxC,OAASS,EAAY+B,EAAUnC,QAAU,GACzDJ,EAASoC,EAAK,kEAAkE,GACrEpC,EAASoC,EAAK,2EAI9BK,GAHeD,EAAczC,OAAS,GAAI2C,MAAKlC,EAAYgC,EAAcpC,QAAQO,QAAQ,MAAO,MAAQ,KAC9FH,EAAY4B,EAAI/B,KAAK4B,GAAiBxB,QAExC2B,EAAI/B,KAAK,gIAAgIsC,GAAG,IAGpJC,GAFO/C,EAAY4C,GAEPL,EAAI/B,KAAK,qIACrBwC,EAAeD,EAAU7C,OAGzB+C,GAFWD,EAAehD,EAAY+C,EAAUD,GAAGE,EAAe,IAAM,GAE5DT,EAAI/B,KAAK,gIACrB0C,EAAeD,EAAU/C,OAGzBiD,GAFWD,EAAelD,EAAYiD,EAAUH,GAAGI,EAAe,IAAM,GAEtD/C,EAASoC,EAAK,iEAChCa,EAAiBD,EAAgBjD,OAASS,EAAYwC,EAAgB5C,QAAU,iCACpF8C,SAAQC,IAAIF","file":"letter_of_credit/static/letter_of_credit/js/process_swift/process_swift.min.js","sourcesContent":["$(function () {\r\n  \"use strict\";\r\n\r\n  var $processSwift = document.getElementById('process-swift')\r\n  var $messageArea = $('.message-area')\r\n\r\n  $('#process-swift-form').submit(function (evt) {\r\n    evt.preventDefault()\r\n    var file = $processSwift.files[0]\r\n    if (!file) return\r\n\r\n    var reader = new FileReader()\r\n    reader.readAsText(file)\r\n    reader.onload = function (e) {\r\n      var $swift = $(e.target.result.trim())\r\n\r\n      var $obj\r\n      for (var i = 0; i < $swift.size(); i++) {\r\n        $obj = $($swift[i])\r\n        if ($obj.is('table')) break\r\n        $obj = null\r\n      }\r\n\r\n      if (!$obj) {\r\n        window.alert('No table selector found, exiting...')\r\n        return\r\n      }\r\n\r\n      var messageSelector = [\r\n        \"div:contains(F20: Transaction Reference Number)\",\r\n        \"div:contains(F20: Sender's Reference)\",\r\n        \"div:contains(F20: Documentary Credit Number)\"\r\n      ].join(',')\r\n\r\n      $obj.find(\"div[id^=AUTOGENBOOKMARK_]:contains(Start of Message)\").each(function () {\r\n        var $td = $(this).parent()\r\n        var type = $td.find('div:contains(fin.)').text()\r\n        var $receiver = getInner($td, \"div[id^=AUTOGENBOOKMARK_]:contains(Receiver Institution)\")\r\n        var receiverBic = $receiver.text()\r\n        var receiverName = getInner($receiver.parent().next(), \"div[id^=AUTOGENBOOKMARK_]:contains(Expansion:)\", true)\r\n        var ourRef = getInner($td, \"div[id^=AUTOGENBOOKMARK_]:contains(Transaction Reference:)\", true)\r\n        var $theirRef = getInner($td, \"div[id^=AUTOGENBOOKMARK_]:contains(Related Reference:)\")\r\n        var theirRef = $theirRef.size() ? processText($theirRef.text()) : ''\r\n        var id = getInner($td, \"div[id^=AUTOGENBOOKMARK_]:contains(Unique Message Identifier:)\", true)\r\n        var $finishedTime = getInner($td, \"div[id^=AUTOGENBOOKMARK_]:contains(ACK/NAK Reception Date/Time (GMT):)\")\r\n        var finishedTime = $finishedTime.size() ? new Date(processText($finishedTime.text()).replace(/\\//g, '-')) : null\r\n        var message = processText($td.find(messageSelector).html())\r\n\r\n        var $auth = $td.find(\"td>div:contains(Routed from rp [_MP_authorisation] to rp [_SI_to_SWIFT]; On Processing by Function mpa with result Success;)\").eq(0)\r\n        var auth = getOperator($auth)\r\n\r\n        var $verifier = $td.find(\"td>div:contains(Routed from rp [_MP_verification] to rp [_MP_authorisation]; On Processing by Function mpa with result Success;)\")\r\n        var verifierSize = $verifier.size()\r\n        var verifier = verifierSize ? getOperator($verifier.eq(verifierSize - 1)) : ''\r\n\r\n        var $modifier = $td.find(\"td>div:contains(Routed from rp [_MP_creation] to rp [_MP_verification]; On Processing by Function mpc with result Success;)\")\r\n        var modifierSize = $modifier.size()\r\n        var modifier = modifierSize ? getOperator($modifier.eq(modifierSize - 1)) : ''\r\n\r\n        var $deliveryStatus = getInner($td, \"div[id^=AUTOGENBOOKMARK_]:contains(Network Delivery Status:)\")\r\n        var deliveryStatus = $deliveryStatus.size() ? processText($deliveryStatus.text()) : 'Message has not been authorized'\r\n        console.log(deliveryStatus)\r\n      })\r\n    }\r\n  })\r\n\r\n  function getOperator($selection) {\r\n    if (!$selection.size()) return ''\r\n    return getInner($selection.parent(), \"div[id^=AUTOGENBOOKMARK_]:contains(Operator:)\", true)\r\n  }\r\n\r\n  function getInner($context, selector, text) {\r\n    var $selection = $context.find(selector).parent().next().children('div')\r\n    return text ? processText($selection.html()) : $selection\r\n  }\r\n\r\n  function processText(html) {\r\n    return html.trim().replace(/<br>/ig, '\\n').replace(/&nbsp;/ig, ' ')\r\n  }\r\n})\r\n"],"sourceRoot":"/source/"}