{"version":3,"sources":["letter_of_credit/static/letter_of_credit/js/process_swift/process_swift.js"],"names":["$","getOperator","$selection","size","getInner","parent","$context","selector","text","find","next","children","processText","html","trim","replace","extractFields200","message","pattern","RegExp","exec","date","ccy","amount","debitAcct","beneAcct","beneBank","dealNo","extractFields202","intermediary","acctWithAcct","acctWithBank","$processSwift","document","getElementById","$messageArea","$messageArea1","submit","evt","preventDefault","hide","val","file","files","reader","FileReader","readAsText","onload","e","$obj","$swift","target","result","i","is","window","alert","messageSelector","join","string","tabbedStr","each","$td","this","type","$receiver","receiverBic","ourRef","$theirRef","theirRef","$finishedTime","finishedTime","Date","$auth","eq","auth","$verifier","verifierSize","verifier","$modifier","modifierSize","modifier","$deliveryStatus","deliveryStatus","msg","keys","str","forEach","key","toString","show"],"mappings":"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","file":"letter_of_credit/static/letter_of_credit/js/process_swift/process_swift.min.js","sourcesContent":["$( function () {\r\n  \"use strict\";\r\n\r\n  var $processSwift = document.getElementById( 'process-swift' )\r\n  var $messageArea = $( '#swift-messages' )\r\n  var $messageArea1 = $( '#swift-messages-20' )\r\n\r\n  $( '#process-swift-form' ).submit( function (evt) {\r\n    evt.preventDefault()\r\n    $messageArea.hide().val( '' )\r\n\r\n    var file = $processSwift.files[ 0 ]\r\n    if ( !file ) return\r\n\r\n    var reader = new FileReader()\r\n    reader.readAsText( file )\r\n    reader.onload = function (e) {\r\n      var $swift = $( e.target.result.trim() )\r\n\r\n      var $obj\r\n      for ( var i = 0; i < $swift.size(); i++ ) {\r\n        $obj = $( $swift[ i ] )\r\n        if ( $obj.is( 'table' ) ) break\r\n        $obj = null\r\n      }\r\n\r\n      if ( !$obj ) {\r\n        window.alert( 'No table selector found, exiting...' )\r\n        return\r\n      }\r\n\r\n      var messageSelector = [\r\n        \"div:contains(F20: Transaction Reference Number)\",\r\n        \"div:contains(F20: Sender's Reference)\",\r\n        \"div:contains(F20: Documentary Credit Number)\"\r\n      ].join( ',' )\r\n\r\n      var string = '',\r\n        tabbedStr = 'Message type\\tOur ref\\tTheir ref\\tDelivery Status\\tAck Time\\tValue Date\\tCurrency\\tAmount\\t' +\r\n          'Debit Bank\\tDebit A/C\\tIntermediary\\tAccount With Institution Bank\\tAccount With Institution A\\C\\t' +\r\n          'Beneficiary Institution Bank\\tBeneficiary Institution A/C\\tDeal No.\\n'\r\n\r\n      $obj.find( \"div[id^=AUTOGENBOOKMARK_]:contains(Start of Message)\" ).each( function () {\r\n        var $td = $( this ).parent()\r\n        var type = $td.find( 'div:contains(fin.)' ).text()\r\n        var $receiver = getInner( $td, \"div[id^=AUTOGENBOOKMARK_]:contains(Receiver Institution)\" )\r\n        var receiverBic = $receiver.text()\r\n        //var receiverName = getInner( $receiver.parent().next(), \"div[id^=AUTOGENBOOKMARK_]:contains(Expansion:)\",\r\n        // true )\r\n        var ourRef = getInner( $td, \"div[id^=AUTOGENBOOKMARK_]:contains(Transaction Reference:)\", true )\r\n        var $theirRef = getInner( $td, \"div[id^=AUTOGENBOOKMARK_]:contains(Related Reference:)\" )\r\n        var theirRef = $theirRef.size() ? processText( $theirRef.text() ) : ''\r\n        //var id = getInner( $td, \"div[id^=AUTOGENBOOKMARK_]:contains(Unique Message Identifier:)\", true )\r\n        var $finishedTime = getInner( $td, \"div[id^=AUTOGENBOOKMARK_]:contains(ACK/NAK Reception Date/Time (GMT):)\" )\r\n        var finishedTime = $finishedTime.size() ? new Date( processText( $finishedTime.text() ).replace( /\\//g, '-' ) ) : null\r\n        var message = processText( $td.find( messageSelector ).html() )\r\n\r\n        var $auth = $td.find( \"td>div:contains(Routed from rp [_MP_authorisation] to rp [_SI_to_SWIFT]; On Processing by Function mpa with result Success;)\" ).eq( 0 )\r\n        var auth = getOperator( $auth )\r\n\r\n        var $verifier = $td.find( \"td>div:contains(Routed from rp [_MP_verification] to rp [_MP_authorisation]; On Processing by Function mpa with result Success;)\" )\r\n        var verifierSize = $verifier.size()\r\n        var verifier = verifierSize ? getOperator( $verifier.eq( verifierSize - 1 ) ) : ''\r\n\r\n        var $modifier = $td.find( \"td>div:contains(Routed from rp [_MP_creation] to rp [_MP_verification]; On Processing by Function mpc with result Success;)\" )\r\n        var modifierSize = $modifier.size()\r\n        var modifier = modifierSize ? getOperator( $modifier.eq( modifierSize - 1 ) ) : ''\r\n\r\n        var $deliveryStatus = getInner( $td, \"div[id^=AUTOGENBOOKMARK_]:contains(Network Delivery Status:)\" )\r\n        var deliveryStatus = $deliveryStatus.size() ? processText( $deliveryStatus.text() ) : 'Message has not been authorized'\r\n\r\n        string += type + '\\n' + receiverBic + '\\n' + ourRef + '\\n' + theirRef + '\\n' + '\\n' +\r\n          message + '\\n\\nInput by:\\t         ' + modifier + '\\nVerified by:\\t  ' + verifier +\r\n          '\\nAuthorized by:\\t  ' + auth + '\\nAuthorization completed at:\\t' + finishedTime +\r\n          '\\nDelivery status:\\t' + deliveryStatus + '\\n================================================\\n\\n\\n\\n'\r\n\r\n        if ( type === 'fin.200' || type === 'fin.202' ) {\r\n          var msg = (type === 'fin.200') ? extractFields200( message ) : extractFields202( message )\r\n\r\n          var keys = [\r\n            'date', 'ccy', 'amount', 'debitBank', 'debitAcct', 'intermediary', 'acctWithBank', 'acctWithAcct',\r\n            'beneBank', 'beneAcct', 'dealNo'\r\n          ]\r\n\r\n          var str = ''\r\n\r\n          keys.forEach( function (key) {\r\n            str += key === 'debitBank' ? receiverBic : (msg[ key ] || '').trim()\r\n            str += '\\t'\r\n          } )\r\n\r\n          finishedTime = finishedTime ? finishedTime.toString().replace( /:\\d+\\s*GMT.+/, '' ) : ''\r\n          tabbedStr += type + '\\t' + ourRef + '\\t' + theirRef + '\\t' + deliveryStatus + '\\t' + finishedTime + '\\t' +\r\n            str + '\\n'\r\n        }\r\n      } )\r\n\r\n      $messageArea.show().val( string )\r\n      $messageArea1.show().val( tabbedStr )\r\n    }\r\n  } )\r\n\r\n  function getOperator($selection) {\r\n    if ( !$selection.size() ) return ''\r\n    return getInner( $selection.parent(), \"div[id^=AUTOGENBOOKMARK_]:contains(Operator:)\", true )\r\n  }\r\n\r\n  function getInner($context, selector, text) {\r\n    var $selection = $context.find( selector ).parent().next().children( 'div' )\r\n    return text ? processText( $selection.html() ) : $selection\r\n  }\r\n\r\n  function processText(html) {\r\n    return html.trim().replace( /<br>/ig, '\\n' ).replace( /&nbsp;/ig, ' ' )\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {String} message\r\n   */\r\n  function extractFields200(message) {\r\n    var pattern = new RegExp(\r\n      \"F32A: Value Date, Currency Code, Amount[.\\\\s]*\" +\r\n      \"Date:\\\\s+\\\\d+\\\\s+(\\\\d{4}\\\\s+[a-zA-Z]+\\\\s+\\\\d+)[.\\\\s]*\" + // extract date\r\n      \"Currency:\\\\s+([A-Z]{3})\\\\s+.+\\\\s*\" +  //extract currency\r\n      \"Amount:\\\\s+([\\\\d,]+)\\\\s+.+\\\\s*\" + // amount\r\n      \"F53B: Sender's Correspondent(?: - Party Identifier - Location)?\\\\s*\" +\r\n      \"Party Identifier:\\\\s+/(.+)\\\\s*\" + // account to debit\r\n      \"F57A: Account With Institution - Party Identifier - Identifier Code\\\\s*\" +\r\n      \"Party Identifier:\\\\s*/(.+)\\\\s*\" + // field 57A a/c\r\n      \"Identifier Code:\\\\s*(.+)\\\\s*[\\\\s\\\\S]+\" + // field 57A bank\r\n      \"Narrative[\\\\s\\\\S]+?((?:\\\\d+/)?\\\\d{3,})\" // deal slip no.\r\n    )\r\n\r\n    var exec = pattern.exec( message )\r\n\r\n    if ( exec ) {\r\n      return {\r\n        date: exec[ 1 ],\r\n        ccy: exec[ 2 ],\r\n        amount: exec[ 3 ].replace( ',', '.' ),\r\n        debitAcct: exec[ 4 ],\r\n        beneAcct: exec[ 5 ],\r\n        beneBank: exec[ 6 ],\r\n        dealNo: exec[ 7 ]\r\n      }\r\n    }\r\n\r\n    return {}\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {String} message\r\n   */\r\n  function extractFields202(message) {\r\n    var pattern = new RegExp(\r\n      \"F32A: Value Date, Currency Code, Amount[.\\\\s]*\" +\r\n      \"Date:\\\\s+\\\\d+\\\\s+(\\\\d{4}\\\\s+[a-zA-Z]+\\\\s+\\\\d+)[.\\\\s]*\" + // extract date\r\n      \"Currency:\\\\s+([A-Z]{3})\\\\s+.+\\\\s*\" +  //extract currency\r\n      \"Amount:\\\\s+([\\\\d,]+)\\\\s+.+\\\\s*\" + // amount\r\n      \"F53B: Sender's Correspondent - Party Identifier - Location\\\\s*\" +\r\n      \"Party Identifier:\\\\s+/(.+)\\\\s*\" + // account to debit\r\n      \"(?:F56A: Intermediary - Party Identifier - Identifier Code\\\\s+Identifier Code:\\\\s+(\\\\S+)\\\\s+)?\" + // field 56a\r\n      \"[\\\\s\\\\S]+?F57A: Account With Institution - Party Identifier - Identifier Code\\\\s*\" +\r\n      \"(?:Party Identifier:\\\\s*/(.+))?\" + // field 57A a/c\r\n      \"[\\\\s\\\\S]+?Identifier Code:\\\\s*(.+)\\\\s*[\\\\s\\\\S]+\" + // field 57A bank\r\n      \"F58A: Beneficiary Institution - Party Identifier - Identifier Code\\\\s+\" +\r\n      \"(?:Party Identifier:\\\\s*/(\\\\S+))?\" + // field 58A a/c\r\n      \"[\\\\s\\\\S]+?Identifier Code:\\\\s*(.+)\\\\s*[\\\\s\\\\S]+\" + // field 58A bank\r\n      \"Narrative[\\\\s\\\\S]+?((?:\\\\d+/)?\\\\d{3,})\" // deal slip no.\r\n    )\r\n\r\n    var exec = pattern.exec( message )\r\n\r\n    if ( exec ) {\r\n      return {\r\n        date: exec[ 1 ],\r\n        ccy: exec[ 2 ],\r\n        amount: exec[ 3 ].replace( ',', '.' ),\r\n        debitAcct: exec[ 4 ],\r\n        intermediary: exec[ 5 ],\r\n        acctWithAcct: exec[ 6 ],\r\n        acctWithBank: exec[ 7 ],\r\n        beneAcct: exec[ 8 ],\r\n        beneBank: exec[ 9 ],\r\n        dealNo: exec[ 10 ]\r\n      }\r\n    }\r\n\r\n    return {}\r\n  }\r\n} )\r\n"],"sourceRoot":"/source/"}