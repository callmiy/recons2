{"version":3,"sources":["letter_of_credit/static/letter_of_credit/js/process_swift/process_swift.js"],"names":["$","getOperator","$selection","size","getInner","parent","$context","selector","text","find","next","children","processText","html","trim","replace","$processSwift","document","getElementById","$messageArea","submit","evt","preventDefault","hide","val","file","files","reader","FileReader","readAsText","onload","e","$obj","$swift","target","result","i","is","window","alert","messageSelector","join","string","each","$td","this","type","$receiver","receiverBic","ourRef","$theirRef","theirRef","$finishedTime","finishedTime","Date","message","$auth","eq","auth","$verifier","verifierSize","verifier","$modifier","modifierSize","modifier","$deliveryStatus","deliveryStatus","show"],"mappings":"AAAAA,EAAE,WACA,YA2EA,SAASC,GAAYC,GACnB,MAAKA,GAAWC,OACTC,EAASF,EAAWG,SAAU,iDAAiD,GADvD,GAIjC,QAASD,GAASE,EAAUC,EAAUC,GACpC,GAAIN,GAAaI,EAASG,KAAKF,GAAUF,SAASK,OAAOC,SAAS,MAClE,OAAOH,GAAOI,EAAYV,EAAWW,QAAUX,EAGjD,QAASU,GAAYC,GACnB,MAAOA,GAAKC,OAAOC,QAAQ,SAAU,MAAMA,QAAQ,WAAY,KApFjE,GAAIC,GAAgBC,SAASC,eAAe,iBACxCC,EAAenB,EAAE,kBAErBA,GAAE,uBAAuBoB,OAAO,SAAUC,GACxCA,EAAIC,iBACJH,EAAaI,OAAOC,IAAI,GAExB,IAAIC,GAAOT,EAAcU,MAAM,EAC/B,IAAKD,EAAL,CAEA,GAAIE,GAAS,GAAIC,WACjBD,GAAOE,WAAWJ,GAClBE,EAAOG,OAAS,SAAUC,GAIxB,IAAK,GADDC,GAFAC,EAASjC,EAAE+B,EAAEG,OAAOC,OAAOrB,QAGtBsB,EAAI,EAAGA,EAAIH,EAAO9B,SACzB6B,EAAOhC,EAAEiC,EAAOG,KACZJ,EAAKK,GAAG,UAFqBD,IAGjCJ,EAAO,IAGT,KAAKA,EAEH,WADAM,QAAOC,MAAM,sCAIf,IAAIC,IACF,kDACA,wCACA,gDACAC,KAAK,KAEHC,EAAS,EAEbV,GAAKvB,KAAK,wDAAwDkC,KAAK,WACrE,GAAIC,GAAM5C,EAAE6C,MAAMxC,SACdyC,EAAOF,EAAInC,KAAK,sBAAsBD,OACtCuC,EAAY3C,EAASwC,EAAK,4DAC1BI,EAAcD,EAAUvC,OAExByC,GADe7C,EAAS2C,EAAU1C,SAASK,OAAQ,kDAAkD,GAC5FN,EAASwC,EAAK,8DAA8D,IACrFM,EAAY9C,EAASwC,EAAK,0DAC1BO,EAAWD,EAAU/C,OAASS,EAAYsC,EAAU1C,QAAU,GAE9D4C,GADKhD,EAASwC,EAAK,kEAAkE,GACrExC,EAASwC,EAAK,2EAC9BS,EAAeD,EAAcjD,OAAS,GAAImD,MAAK1C,EAAYwC,EAAc5C,QAAQO,QAAQ,MAAO,MAAQ,KACxGwC,EAAU3C,EAAYgC,EAAInC,KAAK+B,GAAiB3B,QAEhD2C,EAAQZ,EAAInC,KAAK,gIAAgIgD,GAAG,GACpJC,EAAOzD,EAAYuD,GAEnBG,EAAYf,EAAInC,KAAK,oIACrBmD,EAAeD,EAAUxD,OACzB0D,EAAWD,EAAe3D,EAAY0D,EAAUF,GAAGG,EAAe,IAAM,GAExEE,EAAYlB,EAAInC,KAAK,+HACrBsD,EAAeD,EAAU3D,OACzB6D,EAAWD,EAAe9D,EAAY6D,EAAUL,GAAGM,EAAe,IAAM,GAExEE,EAAkB7D,EAASwC,EAAK,gEAChCsB,EAAiBD,EAAgB9D,OAASS,EAAYqD,EAAgBzD,QAAU,iCAEpFkC,IAAUI,EAAO,KAAOE,EAAc,KAAOC,EAAS,KAAOE,EAAW,OACtEI,EAAU,0BAA6BS,EAAW,oBAAuBH,EACzE,sBAAyBH,EAAO,iCAAoCL,EAClE,sBAAyBa,EAAiB,+DAGhD/C,EAAagD,OAAO3C,IAAIkB","file":"letter_of_credit/static/letter_of_credit/js/process_swift/process_swift.min.js","sourcesContent":["$(function () {\r\n  \"use strict\";\r\n\r\n  var $processSwift = document.getElementById('process-swift')\r\n  var $messageArea = $('#swift-messages')\r\n\r\n  $('#process-swift-form').submit(function (evt) {\r\n    evt.preventDefault()\r\n    $messageArea.hide().val('')\r\n\r\n    var file = $processSwift.files[0]\r\n    if (!file) return\r\n\r\n    var reader = new FileReader()\r\n    reader.readAsText(file)\r\n    reader.onload = function (e) {\r\n      var $swift = $(e.target.result.trim())\r\n\r\n      var $obj\r\n      for (var i = 0; i < $swift.size(); i++) {\r\n        $obj = $($swift[i])\r\n        if ($obj.is('table')) break\r\n        $obj = null\r\n      }\r\n\r\n      if (!$obj) {\r\n        window.alert('No table selector found, exiting...')\r\n        return\r\n      }\r\n\r\n      var messageSelector = [\r\n        \"div:contains(F20: Transaction Reference Number)\",\r\n        \"div:contains(F20: Sender's Reference)\",\r\n        \"div:contains(F20: Documentary Credit Number)\"\r\n      ].join(',')\r\n\r\n      var string = ''\r\n\r\n      $obj.find(\"div[id^=AUTOGENBOOKMARK_]:contains(Start of Message)\").each(function () {\r\n        var $td = $(this).parent()\r\n        var type = $td.find('div:contains(fin.)').text()\r\n        var $receiver = getInner($td, \"div[id^=AUTOGENBOOKMARK_]:contains(Receiver Institution)\")\r\n        var receiverBic = $receiver.text()\r\n        var receiverName = getInner($receiver.parent().next(), \"div[id^=AUTOGENBOOKMARK_]:contains(Expansion:)\", true)\r\n        var ourRef = getInner($td, \"div[id^=AUTOGENBOOKMARK_]:contains(Transaction Reference:)\", true)\r\n        var $theirRef = getInner($td, \"div[id^=AUTOGENBOOKMARK_]:contains(Related Reference:)\")\r\n        var theirRef = $theirRef.size() ? processText($theirRef.text()) : ''\r\n        var id = getInner($td, \"div[id^=AUTOGENBOOKMARK_]:contains(Unique Message Identifier:)\", true)\r\n        var $finishedTime = getInner($td, \"div[id^=AUTOGENBOOKMARK_]:contains(ACK/NAK Reception Date/Time (GMT):)\")\r\n        var finishedTime = $finishedTime.size() ? new Date(processText($finishedTime.text()).replace(/\\//g, '-')) : null\r\n        var message = processText($td.find(messageSelector).html())\r\n\r\n        var $auth = $td.find(\"td>div:contains(Routed from rp [_MP_authorisation] to rp [_SI_to_SWIFT]; On Processing by Function mpa with result Success;)\").eq(0)\r\n        var auth = getOperator($auth)\r\n\r\n        var $verifier = $td.find(\"td>div:contains(Routed from rp [_MP_verification] to rp [_MP_authorisation]; On Processing by Function mpa with result Success;)\")\r\n        var verifierSize = $verifier.size()\r\n        var verifier = verifierSize ? getOperator($verifier.eq(verifierSize - 1)) : ''\r\n\r\n        var $modifier = $td.find(\"td>div:contains(Routed from rp [_MP_creation] to rp [_MP_verification]; On Processing by Function mpc with result Success;)\")\r\n        var modifierSize = $modifier.size()\r\n        var modifier = modifierSize ? getOperator($modifier.eq(modifierSize - 1)) : ''\r\n\r\n        var $deliveryStatus = getInner($td, \"div[id^=AUTOGENBOOKMARK_]:contains(Network Delivery Status:)\")\r\n        var deliveryStatus = $deliveryStatus.size() ? processText($deliveryStatus.text()) : 'Message has not been authorized'\r\n\r\n        string += type + '\\n' + receiverBic + '\\n' + ourRef + '\\n' + theirRef + '\\n' + '\\n' +\r\n          message + '\\n\\nInput by:\\t         ' + modifier + '\\nVerified by:\\t  ' + verifier +\r\n          '\\nAuthorized by:\\t  ' + auth + '\\nAuthorization completed at:\\t' + finishedTime +\r\n            '\\nDelivery status:\\t' + deliveryStatus + '\\n================================================\\n\\n\\n\\n'\r\n      })\r\n\r\n      $messageArea.show().val(string)\r\n    }\r\n  })\r\n\r\n  function getOperator($selection) {\r\n    if (!$selection.size()) return ''\r\n    return getInner($selection.parent(), \"div[id^=AUTOGENBOOKMARK_]:contains(Operator:)\", true)\r\n  }\r\n\r\n  function getInner($context, selector, text) {\r\n    var $selection = $context.find(selector).parent().next().children('div')\r\n    return text ? processText($selection.html()) : $selection\r\n  }\r\n\r\n  function processText(html) {\r\n    return html.trim().replace(/<br>/ig, '\\n').replace(/&nbsp;/ig, ' ')\r\n  }\r\n})\r\n"],"sourceRoot":"/source/"}