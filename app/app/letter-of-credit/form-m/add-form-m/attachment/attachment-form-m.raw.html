<div class="form-m-attachment-container form-m-add-on-container" style="margin-bottom: 30px;">

  <div ng-click="formMAttachment.toggleShow()"
       class="form-m-add-on-toggle form-m-attachment-toggle-show clearfix">

    <div class="form-m-add-on-show-icon form-m-comment-add-on-show-icon">
      <span
        ng-class="['glyphicon', {'glyphicon-chevron-down': !formMAttachment.showAttachment, 'glyphicon-chevron-up': formMAttachment.showAttachment}]">
      </span>

      Attachment
    </div>
  </div>

  <div ng-if="formMAttachment.showAttachment" style="position:relative; margin-top: 30px;">
    <div class="add-attachment-form-toggle"
         ng-click="formMAttachment.showAddAttachmentForm = !formMAttachment.showAddAttachmentForm">
      <div class="add-attachment-form-toggle-line"></div>

      <span class="glyphicon glyphicon-plus-sign"></span>

      <span class="add-attachment-form-toggle-text">Add attachment</span>
    </div>

    <div class="absolute-spacer"></div>

    <div class="form-m-add-attachment-container" add-attachment ng-show="formMAttachment.showAddAttachmentForm"
         on-attachment-file-added="formMAttachment.attachmentFileAdded($attachmentFile)"
         attachment-context="formMAttachment.attachmentContext">
    </div>

    <div class="items-table-display" ng-if="formMAttachment.formM.attachments.length">

      <table class="table table-responsive table-striped table-bordered form-m-attachments-table">
        <caption>
          Attachments <span class="badge">{$formMAttachment.formM.attachments.length$}</span>
        </caption>
        <thead>
          <tr>
            <td style="width: 1px">S/N</td>
            <td>Title</td>
            <td style="width: 220px;">Comment</td>
            <td style="width: 40%;">Files</td>
            <td></td>
          </tr>
        </thead>

        <tbody>
          <tr ng-repeat="attachment in formMAttachment.formM.attachments">
            <td>{$$index + 1$}</td>

            <td>
              {$::attachment.title$}
            </td>

            <td data-toggle="tooltip" data-placement="bottom" title="{$::attachment.comment$}">
              {$::attachment.comment.slice(0, 30)$}
            </td>

            <td>
              <span style="display: block" ng-repeat="file in attachment.files">
                <a style="display: block" class="pull-left" ng-href="{$::file.download_url$}">
                  {$::formMAttachment.getFileName(file.name)$}
                </a>

                <span style="display: block"
                      class="glyphicon glyphicon-trash attachment-control trash-attachment pull-right"
                      data-toggle="tooltip"
                      title="Delete attachment file"
                      ng-click="formMAttachment.deleteSelectedAttachment($index)"></span>

                <span class="clearfix"></span>
              </span>
            </td>

            <td align="center" style="text-align: center;">
              <span class="glyphicon glyphicon-trash attachment-control trash-attachment"
                    data-toggle="tooltip"
                    title="Delete attachment"
                    ng-click="formMAttachment.deleteSelectedAttachment($index)"></span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div style="text-align: right" ng-class="{'no-attachment': !formMAttachment.formM.attachments.length}">
      <button class="btn btn-default" ng-click="formMAttachment.formM.setAttachments()">Refresh</button>
    </div>
  </div>
</div>
