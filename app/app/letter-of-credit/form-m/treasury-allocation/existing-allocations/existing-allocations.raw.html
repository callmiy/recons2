<div class="existing-allocations-directive-container">
  <div class="search-allocation-container">
    <uib-accordion>
      <uib-accordion-group
          is-open="existingAllocations.isAllocationSearchOpen">
        <uib-accordion-heading>
          <i class="glyphicon"
             ng-class="{'glyphicon-chevron-down': existingAllocations.isAllocationSearchOpen, 'glyphicon-chevron-right': !existingAllocations.isAllocationSearchOpen}"></i>
          Search Allocations
        </uib-accordion-heading>

        <div class="search-allocation-inputs">
          <div class="start-end-dates kanmii-input-group">
            <div class="group start-date">
              <label for="start-date" class="label">Start Date</label>

              <div class="the-input-group">
                <input type="text" id="start-date"
                       ng-model="existingAllocations.search.startDate"
                       uib-datepicker-popup="{$existingAllocations.datePickerFormat$}"
                       is-open="existingAllocations.datePickerIsOpenFor.startDate"
                >

              <span class="the-input-group-add-on" ng-click="existingAllocations.openDatePickerFor('startDate')">
                <span class="glyphicon glyphicon-calendar"></span>
              </span>
              </div>

            </div>

            <div class="group end-date">
              <label for="end-date" class="label">End Date</label>

              <div class="the-input-group">
                <input type="text" id="end-date"
                       ng-model="existingAllocations.search.endDate"
                       uib-datepicker-popup="{$existingAllocations.datePickerFormat$}"
                       is-open="existingAllocations.datePickerIsOpenFor.endDate"
                >

              <span class="the-input-group-add-on" ng-click="existingAllocations.openDatePickerFor('endDate')">
                <span class="glyphicon glyphicon-calendar"></span>
              </span>
              </div>

            </div>
          </div>

          <div class="deal-no-ref kanmii-input-group">
            <div class="group deal-no">
              <label for="deal-no" class="label">Deal No.</label>
              <input type="text" id="deal-no" ng-model="existingAllocations.search.dealNo">
            </div>

            <div class="group ref">
              <label for="ref" class="label">Ref</label>
              <input type="text" id="ref" ng-model="existingAllocations.search.ref">
            </div>
          </div>
        </div>

        <div class="form-actions">
          <button class="btn btn-success" type="submit"
                  ng-click="existingAllocations.doSearch(existingAllocations.search)">
            Search
          </button>
          <button class="btn" ng-click="existingAllocations.doSearch()">
            Reset
          </button>
        </div>

      </uib-accordion-group>
    </uib-accordion>
  </div>

  <div class="search-allocations-result treasury-allocations-table-display">
    <table ng-table="existingAllocations.tableParams"
           class="table table-bordered table-condensed table-responsive table-striped">

      <tbody>
        <tr ng-repeat="allocationObj in $data track by allocationObj.index"
            ng-class="{'pasted-bid-row-matched': allocationObj.original_requests}"
        >

          <td data-title="'S/N'">{$$index + 1$}</td>

          <td title="'DEAL NO'" filter="{TRANSACTION_DEAL_SLIP: 'text'}">
            {$::allocationObj.TRANSACTION_DEAL_SLIP$}
          </td>

          <td data-title="'SOURCE'" sortable="'SOURCE_OF_FUND'">{$::allocationObj.SOURCE_OF_FUND$}</td>

          <td data-title="'DEAL DATE'" sortable="'DEAL_DATE'">
            {$::allocationObj.DEAL_DATE | date:'dd-MMM-yyyy'$}
          </td>

          <td data-title="'SETTLEMENT DATE'" sortable="'SETTLEMENT_DATE'">
            {$::allocationObj.SETTLEMENT_DATE | date:'dd-MMM-yyyy'$}
          </td>

          <td data-title="'TYPE'" sortable="'TRANSACTION_TYPE'">{$::allocationObj.TRANSACTION_TYPE$}</td>

          <td data-title="'CATEGORY'" sortable="'CLIENT_CATEGORY'" filter="{CLIENT_CATEGORY:'text'}">
            {$ allocationObj.CLIENT_CATEGORY$}
          </td>

          <td data-title="'RATE'" sortable="'RATE'">{$::allocationObj.RATE $}</td>

          <td data-title="'CCY'" sortable="'CURRENCY'" filter="{CURRENCY:'text'}">{$::allocationObj.CURRENCY $}</td>

          <td data-title="'CUSTOMER NAME'" sortable="'NAME_NO_REF'" filter="{NAME_NO_REF:'text'}">
            {$allocationObj.NAME_NO_REF $}
          </td>

          <td data-title="'REFERENCE'" sortable="'REF'" filter="{REF :'text'}">
            {$allocationObj.REF $}
          </td>

          <td data-title="'CURRENT ALLOCATION'" sortable="'FCY_AMOUNT'" filter="{FCY_AMOUNT: 'number'}">
            {$::allocationObj.FCY_AMOUNT |number:2$}
          </td>

          <td style="min-width: 135px;" data-title="'ORIGINAL REQUEST'" filter="{original_requests :'number'}">
              <span class="original-request-row"
                    ng-repeat="req in allocationObj.original_requests"
                    ng-class="{'multiple-requests': (allocationObj.original_requests.length > 1), 'deleted': (allocationObj.original_requests_deleted[$index] == $index)}">

                {$::req |number:2$}

                <span class="glyphicon remove-add-bid-icons"
                      ng-class="{'glyphicon-remove': (allocationObj.original_requests_deleted[$index] != $index), 'glyphicon-plus-sign': (allocationObj.original_requests_deleted[$index] == $index)}"
                      ng-click="uploadTreasuryAllocation.toggleMapOriginalRequest(allocationObj.index, $index)"></span>
              </span>
          </td>

          <td data-title="'PREVIOUS ALLOCATIONS'" filter="{previous_allocations :'number'}">
              <span class="original-request-row"
                    ng-repeat="req in allocationObj.previous_allocations"
                    ng-class="{'multiple-requests': (allocationObj.original_requests.length > 1), 'deleted': (allocationObj.original_requests_deleted[$index] == $index)}">
                {$::req |number:2$}
              </span>
          </td>

          <td data-title="'PREVIOUS OUTSTANDING'" filter="{previous_outstandings :'number'}">
              <span class="original-request-row"
                    ng-repeat="req in allocationObj.previous_outstandings"
                    ng-class="{'multiple-requests': (allocationObj.original_requests.length > 1), 'deleted': (allocationObj.original_requests_deleted[$index] == $index)}">
                {$::req |number:2$}
              </span>
          </td>

          <td data-title="'CURRENT OUTSTANDING'" sortable="'current_outstandings'">
              <span class="original-request-row" ng-repeat="req in allocationObj.current_outstandings"
                    ng-class="{'multiple-requests': (allocationObj.original_requests.length > 1), 'deleted': (allocationObj.original_requests_deleted[$index] == $index)}">
                {$req |number:2$}
              </span>
          </td>

        </tr>
      </tbody>
    </table>
  </div>
</div>
