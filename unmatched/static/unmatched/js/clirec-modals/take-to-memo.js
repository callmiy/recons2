// Generated by CoffeeScript 1.7.1
$(function() {
  var $crAcctText, $drAcctText, $narr, absNetAmtFormatted, ids, netAmt, rows, selectionSummary, _ref;
  _ref = selectedClirecsEnum(), rows = _ref.rows, ids = _ref.ids, netAmt = _ref.netAmt, absNetAmtFormatted = _ref.absNetAmtFormatted, selectionSummary = _ref.selectionSummary;
  $drAcctText = $('#id_dr_acct_text');
  $crAcctText = $('#id_cr_acct_text');
  $('#id_clirec_ids').val(ids.join(','));
  $("#id_manual_post_amount").val(Math.abs(netAmt));
  $('#id-amount-taken').val(netAmt);
  $("#id-memo-acct").val(clirecUploadUtils.nostroObj.defaultMemoAcct.id);
  $('#id-contra-acct').val(clirecUploadUtils.nostroObj.ledger_acct.id);
  if (netAmt < 0) {
    $crAcctText.val(clirecUploadUtils.nostroObj.ledger_acct.number).addClass('nostro-ledger');
    $('#id_cr_acct').val(clirecUploadUtils.nostroObj.ledger_acct.id);
    $drAcctText.val(clirecUploadUtils.nostroObj.defaultMemoAcct.number);
    $('#id_dr_acct').val(clirecUploadUtils.nostroObj.defaultMemoAcct.id);
  } else {
    $drAcctText.val(clirecUploadUtils.nostroObj.ledger_acct.number).addClass('nostro-ledger');
    $('#id_dr_acct').val(clirecUploadUtils.nostroObj.ledger_acct.id);
    $crAcctText.val(clirecUploadUtils.nostroObj.defaultMemoAcct.number);
    $('#id_cr_acct').val(clirecUploadUtils.nostroObj.defaultMemoAcct.id);
  }
  $('#id_posting_enum').val(_.template("<%=selectionSummary%>\n\n%tab%DR%tab%<%-drAcct%>%tab%<%-absNetAmtFormatted%>\n%tab%CR%tab%<%-crAcct%>%tab%<%-absNetAmtFormatted%>", {
    selectionSummary: selectionSummary,
    absNetAmtFormatted: absNetAmtFormatted,
    drAcct: $drAcctText.val(),
    crAcct: $crAcctText.val()
  }).replace(/%tab%/g, '\t'));
  $narr = $('#id_manual_post_narration');
  return $('#clirec-modal-taken-to-memo-form').submit(function(evt) {
    evt.preventDefault();
    if ($narr.val().length < 3) {
      return alert("Please provide narration");
    }
    return $.ajax({
      url: clirecUploadUtils.getModalActionUrl('take-to-memo'),
      data: $(this).serialize(),
      type: 'post',
      dataType: 'json',
      success: function(resp) {
        var id, _i, _len, _ref1, _results;
        setSuccessMessage(resp);
        _ref1 = resp.ids;
        _results = [];
        for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
          id = _ref1[_i];
          _results.push(setRowComment(rows[id], resp.comment));
        }
        return _results;
      },
      error: function(resp) {
        return alert(resp);
      }
    });
  });
});
