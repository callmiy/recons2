// Generated by CoffeeScript 1.7.1
var $crAcct, $customer, $lcNumber, $tr, clirecDataObj, customerIsCorrect, dataIsCorrect, lcNumberIsCorrect;

$tr = $($rowChkBoxSelector).filter(':checked').parents('tr');

clirecDataObj = getClirecData($tr);

$lcNumber = $('#id_lc_number').val(clirecDataObj.lcNumber);

$customer = $('#id_customer');

$('#id_amount_text').val(clirecDataObj.amount);

$('#id_amount').val(kanmii.formattedToNumber(clirecDataObj.amount));

$('#id_clirec_details').val(clirecDataObj.clirecDetails);

$('#id_clirec_id').val(clirecDataObj.id);

$('#id_val_date_dr').val(clirecDataObj.valDate);

$crAcct = $('#id_cr_acct');

$crAcct.val(clirecUploadUtils.nostroObj.id);

$crAcct.attr('data-plugin-options', clirecUploadUtils.setPluginInitialVal({
  $el: $crAcct,
  text: clirecUploadUtils.nostroObj.number,
  id: clirecUploadUtils.nostroObj.id
}));

lcNumberIsCorrect = function() {
  return $lcNumber.val() && $lcNumber.val().length > 12;
};

customerIsCorrect = function() {
  return /^\d+$/.test($customer.val());
};

dataIsCorrect = function() {
  return lcNumberIsCorrect() && customerIsCorrect();
};

$('#clirec-modal-charge-form').on({
  'submit': function(evt) {
    var $el;
    evt.preventDefault();
    $el = $(this);
    if (!dataIsCorrect()) {
      return window.alert('Customer or LC Number not correct.');
    }
    return $.ajax({
      url: clirecUploadUtils.getModalActionUrl('charge'),
      data: $el.serialize(),
      type: 'POST',
      dataType: 'json',
      success: function(resp) {
        return processSucceeds($tr, resp);
      },
      error: function(resp) {
        return console.log('charge creation fails: ', resp);
      }
    });
  }
});

$(window).trigger('init-autocomplete');
